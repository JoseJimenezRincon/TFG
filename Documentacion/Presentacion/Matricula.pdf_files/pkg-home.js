define("modules/clean/react/home/actions",["require","exports","modules/constants/env","modules/core/browser","modules/core/uri","modules/core/i18n","modules/core/notify","modules/clean/flux/dispatcher","modules/clean/react/home/api","modules/clean/react/home/constants"],function(e,t,o,n,r,i,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(){function e(){}return e.initializeStore=function(e,t){s.dispatch({type:l.HomeActionTypes.INITIALIZE_STORE,payload:{role:e,sectionVisibility:t}})},e.setSectionVisibility=function(e,t,o){s.dispatch({type:l.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:t,visible:o}}),c.setSectionVisibility(e,t,o).catch(function(e){var n=o?i._("Unable to show section."):i._("Unable to hide section.");return a.error(n),s.dispatch({type:l.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:t,visible:!o}}),Promise.reject(e)})},e.createPaperDocInNewTab=function(e){var t=i._("Could not create paper document."),s=window.open("about:blank");c.createPaperDoc(e).then(function(e){if(s&&!s.closed){var i=new r({scheme:"https",authority:o.NOTES_WEBSERVER,path:"/doc/"+e.doc_id}).toString();n.redirect(i,s)}else a.error(t)}).catch(function(e){if(a.error(t),s&&!s.closed)return s.close()})},e})();t.HomeActions=d}),define("modules/clean/react/home/constants",["require","exports","modules/clean/react/user_notifications/constants"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HomeActionTypes={INITIALIZE_STORE:"HOME_INITIALIZE_STORE",SET_SECTION_VISIBILITY:"HOME_SET_SECTION_VISIBILITY"},t.HomeSections={UNREAD:"unread",STARRED:"starred",RECENTS:"recents"},t.LoggingTypes={CLICK_SHOW_ALL:"click_show_all",HOME_PAGE_SHOWN:"home_page_shown",UNREAD_SHOWN:"unread_shown",STARRED_SHOWN:"starred_shown",RECENTS_SHOWN:"recents_shown",HIDE_SECTION:"hide_section",UNHIDE_SECTION:"unhide_section",RECENTS_ITEM_ACTION:"recents_item_action",OPEN_UNREAD_ITEM:"open_unread_document",MARK_AS_READ:"mark_as_read",OPEN_STARRED_ITEM:"open_starred_item",UNSTAR_ITEM:"unstar_item",UNDO_UNSTAR_ITEM:"undo_unstar_item",CLICK_STAR_OVERFLOW_MENU:"click_star_overflow_menu",CLICK_STAR_OVERFLOW_SHARE:"click_star_overflow_share",CLICK_STAR_OVERFLOW_UPLOAD:"click_star_overflow_upload",CLICK_INCOMING_ACTION:"click_incoming_action",CLICK_RIGHT_NAV_ITEM:"click_right_nav_item",CLICK_INCOMING_SHOW_READ:"click_incoming_show_read",CLICK_RECENT_ITEMS:"click_recent_item",OPEN_INCOMING:"open_incoming",OPEN_INCOMING_DOCUMENT:"open_incoming_document",OPEN_STARRED_DOCUMENT:"open_starred_item",OPEN_DOCUMENT:"open_document",CLICK_UPLOAD_FILES:"upload_files",CLICK_CREATE_PAPER_DOC:"create_paper_doc",CLICK_NEW_SHARED_FOLDER:"new_shared_folder"},t.LoggingSections={UNREAD:"home_unread",STARRED:"home_starred",RECENTS:"home_recents"},t.LoggingSectionXHRs=(n={},n[t.LoggingSections.UNREAD]=["notifications/retrieve_user","retrieve_unread"],n[t.LoggingSections.STARRED]=["retrieve_starred"],n[t.LoggingSections.RECENTS]=["recents/json","retrieve_paper_recents"],n),t.LoadingStates={LOADING:"LOADING",SUCCESS:"SUCCESS",FAILURE:"FAILURE"},t.LoadingTypes={INITIAL:"INITIAL",OLDER:"OLDER",NEWER:"NEWER"},t.DisplayTypeToSpriteName={DOC:"page_white_word_32",PDF:"page_white_acrobat_32",SPREADSHEET:"page_white_excel_32",FILE:"page_white_gray_32",FOLDER:"folder_32",SHARED_FOLDER:"folder_user_32",TEAM_FOLDER:"folder_team_32",PAPER_DOCUMENT:"paper_doc_32",PAPER_FOLDER:"folder_paper_team_32",PAPER_PUBLIC_FOLDER:"folder_team_32",PAPER_PROJECT:"paper_project_32"},t.FILE_RESOURCE_TYPE="FILE",t.FOLDER_RESOURCE_TYPE="FOLDER",t.PAPER_DOCUMENT_RESOURCE_TYPE="PAPER_DOCUMENT",t.PAPER_FOLDER_RESOURCE_TYPE="PAPER_FOLDER",t.EXTERNAL_RESOURCE_TYPE="EXTERNAL",t.DisplayTypeToResourceType={DOC:t.FILE_RESOURCE_TYPE,PDF:t.FILE_RESOURCE_TYPE,SPREADSHEET:t.FILE_RESOURCE_TYPE,FILE:t.FILE_RESOURCE_TYPE,FOLDER:t.FOLDER_RESOURCE_TYPE,SHARED_FOLDER:t.FOLDER_RESOURCE_TYPE,TEAM_FOLDER:t.FOLDER_RESOURCE_TYPE,PAPER_DOCUMENT:t.PAPER_DOCUMENT_RESOURCE_TYPE,PAPER_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PUBLIC_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PROJECT:t.PAPER_FOLDER_RESOURCE_TYPE},t.FeedTypes={UNREAD:"unread",INCOMING:"incoming"},t.ExceptionTags={UNREAD:"home_unread"},t.DisplayTypes={DOC:"DOC",PDF:"PDF",SPREADSHEET:"SPREADSHEET",FILE:"FILE",FOLDER:"FOLDER",SHARED_FOLDER:"SHARED_FOLDER",TEAM_FOLDER:"TEAM_FOLDER",PAPER_DOCUMENT:"PAPER_DOCUMENT",PAPER_FOLDER:"PAPER_FOLDER",PAPER_PUBLIC_FOLDER:"PAPER_PUBLIC_FOLDER",PAPER_PROJECT:"PAPER_PROJECT"},t.DisplayTypeToIconName={FOLDER:"folder",SHARED_FOLDER:"folder_shared",TEAM_FOLDER:"folder_team",PAPER_DOCUMENT:"paper",PAPER_FOLDER:"folder",PAPER_PUBLIC_FOLDER:"folder_team",PAPER_PROJECT:"folder_project"},t.BluenoteObjectTypeToDisplayType=(r={},r[o.BluenoteObjectTypes.DROPBOX_FILE]=t.DisplayTypes.FILE,r[o.BluenoteObjectTypes.DROPBOX_FOLDER]=t.DisplayTypes.FOLDER,r[o.BluenoteObjectTypes.PAPER_PAD]=t.DisplayTypes.PAPER_DOCUMENT,r[o.BluenoteObjectTypes.PAPER_FOLDER]=t.DisplayTypes.PAPER_FOLDER,r);var n,r}),define("modules/clean/react/home/home_access/home_access_main",["require","exports","tslib","jquery","external/react","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/home_access/onboarding/actions","modules/clean/react/home/home_access/recents/section","modules/clean/react/home/home_access/recents/utils/events","modules/clean/react/home/home_access/unread/home_access_unread","modules/clean/react/home/starred/starred_view","modules/clean/react/home/store","modules/clean/react/home/util/logging/activity_logger","modules/clean/react_logger","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/stores/federated_recent_activity_store","modules/clean/recent_activity/versions/recent_activity_version_2","modules/clean/react/home/util/constants","modules/clean/web_timing_logger","modules/clean/user_education/user_education_client","modules/clean/user_education/user_education_interface"],function(e,t,o,n,r,i,a,s,c,l,d,u,m,p,_,h,g,y,f,E,v,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var R=(function(e){function t(o){var n=e.call(this,t.displayName,o)||this;n.updateWidth=function(){var e=n.refs&&n.refs.main;e&&e.getBoundingClientRect&&n.setState({width:e.getBoundingClientRect().width||f.DEFAULT_HOME_WIDTH})},n.onFederatedRecentActivityStoreUpdate=function(){if(g.FederatedRecentActivityStore.didReceiveItemsFromAllStreams()){var e=y.RecentActivityVersion2.getRecentItems(n.props.user.id,h.RECENT_EVENT_FILTER_TYPE.ALL),t=!n.state.sectionVisibility[a.HomeSections.RECENTS];if(e.length){var o=l.countRecentsItem(e);p.homeActivityLogger.logRecentsShown(o.numMetaserverItems,o.numPaperItems,t)}}},n.onHomeStoreUpdate=function(){n.setState({sectionVisibility:m.HomeStore.getSectionVisibility()})},n.state={sectionVisibility:o.initialSectionVisibility,width:f.DEFAULT_HOME_WIDTH};var r=g.FederatedRecentActivityStore.addListener(n.onFederatedRecentActivityStoreUpdate),i=m.HomeStore.addListener(n.onHomeStoreUpdate);return n.removeStoreListeners=function(){r(),i()},n}return o.__extends(t,e),t.prototype.componentWillMount=function(){e.prototype.componentWillMount.call(this),E.log_js_modules_application_code_start(),v.eventEmitter.on(S.UserEducationStateChannel,function(e){var t=function(e){n("html, body").animate({scrollTop:e},500)},o=e.step;if(o)if(o.name===f.HOME_V1_USER_EDUCATION_STEP_NAMES.RECENTLY_VIEWED){var r=n(".home-recents-section").offset().top,i=n(".maestro-header"),a=i.outerHeight()+i.offset().top;t(r-a)}else o.name===f.HOME_V1_USER_EDUCATION_STEP_NAMES.FILES&&t(0)}),i.HomeActions.initializeStore(this.props.role,this.props.initialSectionVisibility),s.updateShowUnreadOnboarding(this.props.showUnreadOnboarding),this.props.onboardingComplete&&s.markHomeOnboardingComplete()},t.prototype.componentDidMount=function(){this.updateWidth(),window.addEventListener("resize",this.updateWidth)},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateWidth),this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.componentWillReceiveProps=function(e){!this.props.hasAsyncRendered&&e.hasAsyncRendered&&this.updateWidth()},t.prototype.render=function(){return r.createElement("main",{className:"home-access",role:"main"},r.createElement("ul",{className:"home-access-sections",ref:"main"},r.createElement("li",{className:"home-access-section"},r.createElement(d.HomeAccessUnread,{width:this.state.width})),r.createElement("li",{className:"home-access-section"},r.createElement(u.StarredView,{user:this.props.user,hideSection:this.props.hideStarredSection,isListView:this.props.betas.hasStarredListView,width:this.state.width})),r.createElement("li",{className:"home-access-section"},r.createElement(c.HomeRecentsSection,{user:this.props.user,role:this.props.role,isHiddenByUser:!this.state.sectionVisibility[a.HomeSections.RECENTS],shouldThrottleRecents:this.props.betas.shouldThrottleRecents,shouldAllowHiddenRecents:this.props.betas.shouldAllowHiddenRecents}))))},t})(_.ReactPureLogger);R.displayName="HomeAccessMain",R.defaultProps={showUnreadOnboarding:!1},t.HomeAccessMain=R}),define("modules/clean/react/home/home_access/home_access_web",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/home/home_access/home_access_main","modules/clean/react/home/home_access/sidebar","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/maestro/header","modules/clean/react/maestro/layout","modules/clean/viewer","modules/core/i18n","modules/clean/history","modules/clean/react_logger","modules/pagelet_config"],function(e,t,o,n,r,i,a,s,c,l,d,u,m,p,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(o){var n=e.call(this,t.displayName,o)||this;return n.markHomeAsRendered=function(){var e=window.ensemble;e&&(e.markPageletRenderedByDOMNode?e.markPageletRenderedByDOMNode(r.findDOMNode(n)):e.markPageletRendered&&e.markPageletRendered(_.REQUIREJS_CONFIG.context)),n.setState({hasAsyncRendered:!0})},n.state={hasAsyncRendered:!1},n}return o.__extends(t,e),t.prototype.renderMain=function(e,t){var o={hasStarredListView:this.props.hasStarredListView,shouldThrottleRecents:this.props.shouldThrottleRecents,shouldAllowHiddenRecents:this.props.shouldAllowHiddenRecents};return n.createElement("div",{className:"home"},n.createElement(i.HomeAccessMain,{role:this.props.initialRole,user:e,viewer:t,betas:o,hasAsyncRendered:this.state.hasAsyncRendered,hideStarredSection:this.props.hideStarredSection,showUnreadOnboarding:this.props.showUnreadOnboarding,onboardingComplete:this.props.onboardingComplete,initialSectionVisibility:this.props.initialSectionVisibility}))},t.prototype.renderSidebar=function(e){return this.props.shouldShowSidebar?n.createElement(a.HomeSidebar,{user:e,isPaperEnabledForUser:this.props.isPaperEnabledForUser,removeBasicUploader:this.props.removeBasicUploader}):null},t.prototype.componentDidMount=function(){m.remove_query_param("role"),e.prototype.componentDidMount.call(this),s.homeTimingLogger.registerLoadCallback(this.markHomeAsRendered,4e3)},t.prototype.render=function(){var e=d.get_viewer(),t=e.get_user_by_role(this.props.initialRole);return t?n.createElement(l.MaestroChrome,{user:t,embeddedAppRegion:this.renderMain(t,e),titleRegion:n.createElement(c.MaestroHeaderTitle,null,u._("Home")),actionSidebarRegion:this.renderSidebar(t)}):null},t})(p.ReactPureLogger);h.displayName="HomeAccessWeb",t.HomeAccessWeb=h}),define("modules/clean/react/home/home_access/onboarding/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/home/home_access/onboarding/api","modules/clean/react/home/home_access/onboarding/constants","modules/clean/react/home/home_access/onboarding/store","modules/clean/react/home/home_access/onboarding/tooltips"],function(e,t,o,n,r,i,a){"use strict";function s(){o.dispatch({type:r.HomeOnboardingActionTypes.SET_ONBOARDING_COMPLETE})}function c(){i.HomeOnboardingStore.shouldShowUnreadOnboarding()&&a.showUnreadTooltipIfRendered()&&(n.hideUnreadOnboarding(),l(!1))}function l(e){o.dispatch({type:r.HomeOnboardingActionTypes.UPDATE_SHOW_UNREAD_ONBOARDING,showUnreadOnboarding:e})}Object.defineProperty(t,"__esModule",{value:!0}),t.markHomeOnboardingComplete=s,t.showUnreadOnboardingTooltipIfNecessary=c,t.updateShowUnreadOnboarding=l}),define("modules/clean/react/home/home_access/onboarding/api",["require","exports","modules/clean/react/home/store","modules/clean/react/home/api"],function(e,t,o,n){"use strict";function r(){return n.makeRequest({url:"/home_feed/hide_unread_onboarding",type:"POST",data:{role:o.HomeStore.getRole()}})}Object.defineProperty(t,"__esModule",{value:!0}),t.hideUnreadOnboarding=r}),define("modules/clean/react/home/home_access/onboarding/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HomeOnboardingActionTypes={SET_ONBOARDING_COMPLETE:"HOME_ONBOARDING_SET_ONBOARDING_COMPLETE",UPDATE_SHOW_UNREAD_ONBOARDING:"HOME_ONBOARDING_UPDATE_SHOW_UNREAD_ONBOARDING"}}),define("modules/clean/react/home/home_access/onboarding/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/home_access/onboarding/constants","modules/clean/flux/flux_store"],function(e,t,o,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=e.call(this,n)||this;return t.isOnboardingComplete=!1,t.showUnreadOnboarding=!1,t}return o.__extends(t,e),t.prototype.getIsOnboardingComplete=function(){return this.isOnboardingComplete},t.prototype.shouldShowUnreadOnboarding=function(){return this.showUnreadOnboarding&&this.getIsOnboardingComplete()},t.prototype.onUpdateShowUnreadOnboarding=function(e){this.showUnreadOnboarding=e},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case r.HomeOnboardingActionTypes.SET_ONBOARDING_COMPLETE:this.isOnboardingComplete=!0;break;case r.HomeOnboardingActionTypes.UPDATE_SHOW_UNREAD_ONBOARDING:this.onUpdateShowUnreadOnboarding(t.showUnreadOnboarding);break;default:return}this.__emitChange()},t})(i);t.HomeOnboardingStoreClass=a,t.HomeOnboardingStore=new a}),define("modules/clean/react/home/home_access/onboarding/tooltips",["require","exports","jquery","modules/core/i18n","modules/clean/react/home/util/static_tooltip"],function(e,t,o,n,r){"use strict";function i(e,t,n,i,a){var c=o(e);return!(!c||!c.get(0))&&((new r.StaticTooltip).show(t,n,c.get(0),i,s,s,a),!0)}function a(){return i(".home__unread-card--first",n._("Tip"),n._("New shared files and comments show up here."),r.StaticTooltip.POSITIONS.TOP_LEFT,"home-tooltip__unread-onboarding")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){return null};t.showUnreadTooltipIfRendered=a}),define("modules/clean/react/home/home_access/recents/home_access_recents_v2",["require","exports","tslib","external/react","modules/clean/recent_activity/react/recent_activity_container","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/constants","modules/clean/recent_activity/versions/recent_activity_version_2","modules/clean/react_logger"],function(e,t,o,n,r,i,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=i.timingComponent(r.RecentActivityContainer,a.LoggingSections.RECENTS),d=(function(e){function t(o){var n=e.call(this,t.displayName,o)||this;return n.handleVisibilityChange=function(){"visible"===document.visibilityState&&s.RecentActivityVersion2.loadPage(n.props.user.id,!0)},n}return o.__extends(t,e),t.prototype.componentWillUnmount=function(){document.removeEventListener("visibilitychange",this.handleVisibilityChange)},t.prototype.componentDidMount=function(){document.addEventListener("visibilitychange",this.handleVisibilityChange,!1),e.prototype.componentDidMount.call(this)},t.prototype.render=function(){return n.createElement(l,{version:s.RecentActivityVersion2,initialRole:this.props.role,user:this.props.user,shouldThrottleRecents:this.props.shouldThrottleRecents})},t})(c.ReactPureLogger);d.displayName="HomeAccessRecentsV2",t.HomeAccessRecentsV2=d}),define("modules/clean/react/home/home_access/recents/section",["require","exports","tslib","external/react","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/home_access/recents/home_access_recents_v2","modules/clean/react/home/section_header","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/logging/activity_logger","modules/core/i18n"],function(e,t,o,n,r,i,a,s,c,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeRecentsVisibility=function(){var e=!t.props.isHiddenByUser;r.HomeActions.setSectionVisibility(t.props.user.id,i.HomeSections.RECENTS,!e),l.homeActivityLogger.logShowHideSection(i.HomeSections.RECENTS,e)},t.renderHiddenText=function(){return n.createElement("div",{className:"home-access__recents-hidden-text u-pad-vertical-m"},d._("Your recently viewed files are hidden")," · ",n.createElement("button",{className:"button-as-link",onClick:t.onChangeRecentsVisibility},d._("Show")))},t}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.props.isHiddenByUser&&this.props.shouldAllowHiddenRecents&&(c.homeTimingLogger.activate(),c.homeTimingLogger.logTTData(i.LoggingSections.RECENTS),c.homeTimingLogger.logTTI(i.LoggingSections.RECENTS))},t.prototype.render=function(){var e=null,t="initial",r=null;return this.props.shouldAllowHiddenRecents&&(this.props.isHiddenByUser?(e=d._("Show"),t="none",r=this.renderHiddenText()):e=d._("Hide")),n.createElement("span",{className:"home-recents-section"},n.createElement(s.SectionHeader,{title:d._("Recently viewed"),ueName:"recents",buttonText:e,buttonAction:this.onChangeRecentsVisibility}),n.createElement("div",{className:"home-access-section__content u-pad-vertical-s"},r,n.createElement("div",{style:{display:t}},n.createElement(a.HomeAccessRecentsV2,o.__assign({},this.props)))))},t})(n.PureComponent);u.displayName="HomeRecentsSection",t.HomeRecentsSection=u}),define("modules/clean/react/home/home_access/recents/utils/events",["require","exports","jquery","external/underscore","external/react-dom","modules/clean/recent_activity/recent_activity_logger","modules/clean/react/home/util/logging/activity_logger"],function(e,t,o,n,r,i,a){"use strict";function s(e,o,n,r,i){var s=t.extractLogInfo(e,o,n,r,i);return a.homeActivityLogger.logRecentsAction(s.actionTaken,s.scope,s.itemNumber,s.extension,s.sprite,s.subgroupPosition)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(e,t){return 1===e?i.ActionScopes.SINGLE:t.length===e?i.ActionScopes.AGGREGATION:i.ActionScopes.SUBSET},l=function(e){var t=e.find(".recents-item__icon img.sprite");if(t.length)for(var o=t.attr("class").split(/\s+/),n=0,r=o;n<r.length;n++){var i=r[n];if(i.match(/^s_.*_32$/))return i}return"thumbnail"},d=function(e){var t=e.closest(".recents-view"),o=e.closest(".recents-item");return t.find(".recents-item").index(o)},u=function(e,t,o,n,r){if(e===i.ActionScopes.AGGREGATION||o===i.ActionTypes.COLLAPSE||o===i.ActionTypes.UNCOLLAPSE)return"various";for(var a=0,s=["paper_doc","folder","paper_project"];a<s.length;a++){var c=s[a];if(t.indexOf(c)>=0)return"n/a"}var l=n[r],d=l.lastIndexOf(".");return d===-1?"":l.substr(d+1)},m=function(e,t,o,n){return e===i.ActionScopes.AGGREGATION?o.props.recentItem?0:t+1:e===i.ActionScopes.SUBSET?n.hasClass("recents-item")?0:n.index()+1:0};t.extractLogInfo=function(e,t,n,i,a){var s=o(r.findDOMNode(t)),p=c(i,n),_=l(s);return{actionTaken:e,scope:p,itemNumber:d(s),extension:u(p,_,e,n,a||0),sprite:_,subgroupPosition:m(p,a||0,t,s)}},t.countRecentsItem=function(e){var t=n.countBy(e,function(e){switch(e.type){case 1:return"metaserver";case 16:return"paper";default:return"unknown"}});return{numMetaserverItems:t.metaserver||0,numPaperItems:t.paper||0}},t.logEvent=s}),define("modules/clean/react/home/home_access/sidebar",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/app_actions_view","modules/clean/react/file_uploader/file_uploader","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/util/logging/activity_logger","modules/clean/sharing/wizard/async_wizard_modals","modules/clean/web_timing_logger"],function(e,t,o,n,r,i,a,s,c,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleUploadFiles=function(){a.FileUploaderController.showModal(),l.homeActivityLogger.logClickRightMenu(c.LoggingTypes.CLICK_UPLOAD_FILES)},t.handleCreateSharedFolder=function(){d.asyncShowShareAFolderWizardModal(t.props.user,function(e){l.homeActivityLogger.logClickRightMenu(c.LoggingTypes.CLICK_NEW_SHARED_FOLDER,e)})},t.handleCreatePaperDoc=function(){s.HomeActions.createPaperDocInNewTab(t.props.user.id),l.homeActivityLogger.logClickRightMenu(c.LoggingTypes.CLICK_CREATE_PAPER_DOC)},t}return o.__extends(t,e),t.prototype.componentDidMount=function(){a.FileUploaderController.setUser(this.props.user),u.waitForTTI().then(function(){a.FileUploaderController.loadCoreComponent()})},t.prototype.render=function(){var e=this.props.user.is_cdm_member?this.props.user.cdm_tmf_path:"/",t=[{displayName:r._("New shared folder"),iconName:"new-shared-folder",handleClick:this.handleCreateSharedFolder}];return this.props.isPaperEnabledForUser&&t.push({displayName:r._("Create Paper doc"),iconName:"new-paper-doc",handleClick:this.handleCreatePaperDoc}),n.createElement("div",{className:"home-access-sidebar"},n.createElement(a.FileUploaderController,{loadOnRender:!1,needToSetStoreValues:!0,dragAndDropEnabled:!1,initialPath:e,removeBasicUploader:this.props.removeBasicUploader}),n.createElement(i.AppActionsView,{primaryMenuItem:{displayName:r._("Upload files"),handleClick:this.handleUploadFiles,className:"action-upload"},secondaryMenuItems:t}))},t})(n.PureComponent);t.HomeSidebar=m}),define("modules/clean/react/home/home_access/unread/activity_snippet",["require","exports","external/react"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadActivitySnippet=function(e){var t=e.snippetElement,n=e.aggregationText;return o.createElement("div",{className:"home__unread-activity"},o.createElement("div",{className:"home__unread-activity-snippet",children:t}),n?o.createElement("div",{className:"home__doc-sticker"},n):null)},t.UnreadActivitySnippet.displayName="UnreadActivitySnippet"}),define("modules/clean/react/home/home_access/unread/card",["require","exports","tslib","external/react","external/classnames","modules/clean/react/home/constants","modules/clean/react/home/home_access/unread/activity_snippet","modules/clean/react/home/home_access/unread/detail","modules/clean/react/home/home_access/unread/helpers","modules/clean/react/home/util/doc_with_avatar_icon","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/util/navigation","modules/clean/react/user_notifications/actions","modules/core/i18n","modules/core/exception","modules/clean/react_logger"],function(e,t,o,n,r,i,a,s,c,l,d,u,m,p,_,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=(function(e){function t(o){return e.call(this,t.displayName,o)||this}return o.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.actionMetadata,o=t.actorName,i=t.avatarIcon,c=t.notificationType,d=t.snippetText,u=this.props.resourceMetadata,m=u.resourceTitle,_=u.uriString,h=r({"home__unread-card":!0,"home__unread-card--last-in-row":this.props.lastInRow,"home__unread-card--first":this.props.isFirstCard}),g=function(t,o,n){t.stopPropagation(),t.preventDefault(),"BUTTON"!==n.tagName&&e.props.logClickAndOpen(_,o,t)},y=function(e){return function(t){return g(t,e,t.target)}},f=function(e){return function(t){"Enter"===t.key&&g(t,e,t.target)}};return n.createElement("span",{className:h,onClick:y("card"),onKeyPress:f("card"),href:_,style:{width:this.props.width},"aria-label":"unread-item",role:"button"},n.createElement("div",{className:"home__doc-header"},n.createElement("span",{className:"home__doc-header__icon",onClick:y("icon"),onKeyPress:f("icon"),href:_,"aria-label":"unread-item-icon",role:"button"},n.createElement(l.DocWithAvatarIcon,{avatarIconModel:i,displayType:this.props.displayType,fileName:this.props.resourceMetadata.resourceTitle})),n.createElement("div",{className:"home__doc-text"},n.createElement("div",{className:"home__doc-title-group"},n.createElement("span",{className:"home__doc-title",onClick:y("title"),onKeyPress:f("title"),href:_,"aria-label":"unread-item-title",tabIndex:0,role:"button"},m),n.createElement("button",{className:"home__doc-unread-indicator button-as-link",title:p._("Mark as read"),"aria-label":p._("Mark as read"),onClick:this.props.markRead},p._("Mark as read"))),n.createElement("span",{className:"home__doc-detail",onClick:y("detail"),onKeyPress:f("detail"),href:_,"aria-label":"unread-item-detail",role:"button"},n.createElement(s.UnreadEntryDetail,{actorName:o,notificationType:c,feedTime:this.props.feedTime})))),n.createElement("span",{className:"home__doc-snippet",onClick:y("snippet"),onKeyPress:f("snippet"),href:_,"aria-label":"unread-item-snippet",role:"button"},n.createElement(a.UnreadActivitySnippet,{snippetElement:d,aggregationText:this.props.stickerText})))},t})(h.ReactPureLogger);g.displayName="UnreadCardView",t.UnreadCardView=g;var y=(function(e){function t(o){var n=e.call(this,t.displayName,o)||this;return n.logClickAndOpen=function(e,t,o){var r=function(){return d.homeActivityLogger.logOpenUnreadNotificationItem(n.props.notification,i.LoggingSections.UNREAD,t,n.props.position)};u.logAndNavigate(e,r,o)},n.logAndMarkRead=function(e){d.homeActivityLogger.logMarkNotificationAsRead(n.props.notification,n.props.position),e.stopPropagation(),e.preventDefault(),m.acknowledge(n.props.notification)},n}return o.__extends(t,e),t.prototype.render=function(){var e=this.props.notification,t=c.getNotificationMetadata(e);return t?n.createElement(g,{actionMetadata:t.actionMetadata,feedTime:e.feedTime,displayType:t.displayType,isFirstCard:this.props.isFirstCard,lastInRow:this.props.lastInRow,logClickAndOpen:this.logClickAndOpen,markRead:this.logAndMarkRead,resourceMetadata:t.resourceMetadata,stickerText:null,width:this.props.width}):(_.reportException({err:new Error("missing metadata for Home Access Unread card"),tags:[i.ExceptionTags.UNREAD]}),null)},t})(h.ReactPureLogger);y.displayName="UnreadNotificationCard",t.UnreadNotificationCard=y}),define("modules/clean/react/home/home_access/unread/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UNREAD_NOTIFICATION_TYPES={DOC_SHARE:"DOC_SHARE",FOLDER_SHARE:"FOLDER_SHARE",MENTION:"MENTION",COMMENT:"COMMENT",UNKNOWN:"UNKNOWN"}}),define("modules/clean/react/home/home_access/unread/detail",["require","exports","external/react","modules/clean/datetime","modules/clean/react_format","modules/core/i18n","modules/clean/react/home/home_access/unread/constants"],function(e,t,o,n,r,i,a){"use strict";function s(e){switch(e){case a.UNREAD_NOTIFICATION_TYPES.DOC_SHARE:return i._("<actor_span>%(actor_name)s</actor_span> shared %(ago)s");case a.UNREAD_NOTIFICATION_TYPES.FOLDER_SHARE:return i._("<actor_span>%(actor_name)s</actor_span> invited you %(ago)s");case a.UNREAD_NOTIFICATION_TYPES.MENTION:return i._("<actor_span>%(actor_name)s</actor_span> mentioned you %(ago)s");case a.UNREAD_NOTIFICATION_TYPES.COMMENT:return i._("<actor_span>%(actor_name)s</actor_span> commented %(ago)s");default:return i._("Unknown notification")}}Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadEntryDetail=function(e){var t=e.actorName,i=e.feedTime,a=e.notificationType,c=r.reactFormat(s(a),{actor_name:t,actor_span:o.createElement("span",{className:"home__unread-detail-actor"}),ago:n.ago(i,!1)});return o.createElement("div",{className:"home__unread-detail-header",children:c})},t.UnreadEntryDetail.displayName="UnreadEntryDetail"}),define("modules/clean/react/home/home_access/unread/helpers",["require","exports","external/react","external/underscore","modules/clean/react/home/constants","modules/clean/react/home/util/avatar_icon","modules/clean/react/home/home_access/unread/constants","modules/clean/react/user_notifications/constants"],function(e,t,o,n,r,i,a,s){"use strict";function c(e){return e.bluenoteActor&&e.bluenoteNotificationTypeId&&e.bluenoteObject&&e.bluenoteTypedData&&d[e.bluenoteNotificationTypeId]}function l(e){if(!(e.bluenoteActor&&e.bluenoteNotificationTypeId&&e.bluenoteObject&&e.bluenoteTypedData))return null;var t,c,l,d=i.AvatarIconModel.deserializer({avatarInitials:e.bluenoteActor.initials,avatarUrl:e.bluenoteActor.avatarUrl});switch(e.bluenoteNotificationTypeId){case s.BNNotificationTypeIdentifier.DROPBOX_FILE_COMMENT:t=a.UNREAD_NOTIFICATION_TYPES.COMMENT,l=e.bluenoteTypedData,c=l.commentText;break;case s.BNNotificationTypeIdentifier.DROPBOX_SHARED_CONTENT:t=e.bluenoteObject.type===s.BluenoteObjectTypes.DROPBOX_FILE?a.UNREAD_NOTIFICATION_TYPES.DOC_SHARE:a.UNREAD_NOTIFICATION_TYPES.FOLDER_SHARE,l=e.bluenoteTypedData,c=l.shareText;break;case s.BNNotificationTypeIdentifier.PAPER_SHARE:t=a.UNREAD_NOTIFICATION_TYPES.DOC_SHARE,l=e.bluenoteTypedData,c=l.shareText;break;case s.BNNotificationTypeIdentifier.PAPER_COMMENT:t=a.UNREAD_NOTIFICATION_TYPES.COMMENT,l=e.bluenoteTypedData,c=l.commentText;break;case s.BNNotificationTypeIdentifier.PAPER_MENTION:t=a.UNREAD_NOTIFICATION_TYPES.MENTION,l=e.bluenoteTypedData,c=l.mentionText;break;default:t=a.UNREAD_NOTIFICATION_TYPES.UNKNOWN,c=""}return{actionMetadata:{actorName:e.bluenoteActor.displayName,avatarIcon:d,notificationType:t,snippetText:o.createElement("span",null,n.unescape(c))},resourceMetadata:{resourceTitle:n.unescape(e.bluenoteObject.name),uriString:n.unescape(e.bluenoteObject.url)},displayType:r.BluenoteObjectTypeToDisplayType[e.bluenoteObject.type]}}Object.defineProperty(t,"__esModule",{value:!0});var d=(u={},u[s.BNNotificationTypeIdentifier.DROPBOX_FILE_COMMENT]=!0,u[s.BNNotificationTypeIdentifier.DROPBOX_SHARED_CONTENT]=!0,u[s.BNNotificationTypeIdentifier.PAPER_SHARE]=!0,u[s.BNNotificationTypeIdentifier.PAPER_COMMENT]=!0,u[s.BNNotificationTypeIdentifier.PAPER_MENTION]=!0,u);t.isValidNotification=c,t.getNotificationMetadata=l;var u}),define("modules/clean/react/home/home_access/unread/home_access_unread",["require","exports","tslib","external/react","modules/clean/react/home/constants","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/section_header","modules/clean/react/home/home_access/unread/card","modules/clean/react/home/util/rendering","modules/core/i18n","modules/clean/react/home/home_access/unread/store","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/home_access/onboarding/actions","modules/clean/react_logger"],function(e,t,o,n,r,i,a,s,c,l,d,u,m,p,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(o){var n=e.call(this,t.displayName,o)||this;return n.onStoreUpdate=function(){var e=u.getHomeUnreadStore(),t=e.getNotifications(),o=e.getLoadingState();if(o===r.LoadingStates.SUCCESS){a.homeTimingLogger.logTTData(r.LoggingSections.UNREAD);var i=l.calculateItemsToShow(n.props.width,t.length,296,416,16,1),s=i.itemsPerRow,c=i.itemWidth,d=i.numRows,p=i.hasHiddenRows;m.homeActivityLogger.logUnreadShown(t.length,s,c,d,p)}n.setState({loadingState:o,notifications:t})},n.toggleShowAll=function(){m.homeActivityLogger.logClickShowAll("unread",!n.state.showAll),n.setState({showAll:!n.state.showAll})},n.state={notifications:[],loadingState:r.LoadingStates.LOADING,showAll:!1},n}return o.__extends(t,e),
t.prototype.componentWillMount=function(){var t=u.getHomeUnreadStore();this.removeStoreListener=t.addListener(this.onStoreUpdate),t.getLoadingState()===r.LoadingStates.SUCCESS&&this.onStoreUpdate(),e.prototype.componentWillMount.call(this)},t.prototype.componentDidMount=function(){this.triggerOnboarding(),e.prototype.componentDidMount.call(this)},t.prototype.componentWillUnmount=function(){this.removeStoreListener&&this.removeStoreListener()},t.prototype.componentDidUpdate=function(){this.triggerOnboarding()},t.prototype.triggerOnboarding=function(){setTimeout(p.showUnreadOnboardingTooltipIfNecessary)},t.prototype.shouldShowSection=function(){return this.state.loadingState===r.LoadingStates.SUCCESS&&this.state.notifications.length>0&&this.props.width},t.prototype.buttonText=function(e){return e?this.state.showAll?d._("Show less"):d._("Show all"):null},t.prototype.renderCards=function(e,t){if(!this.props.width)return null;var o=this.state.showAll?this.state.notifications:this.state.notifications.slice(0,e);return m.homeActivityLogger.logRenderedNotifications(o),o.map(function(o,r){var i=r%e===e-1;return n.createElement(c.UnreadNotificationCard,{notification:o,width:t,lastInRow:i,position:r,isFirstCard:0===r,key:o.key})})},t.prototype.render=function(){if(!this.shouldShowSection())return null;var e=l.calculateItemsToShow(this.props.width,this.state.notifications.length,296,416,16,1),t=e.hasHiddenRows,o=this.renderCards(e.itemsPerRow,e.itemWidth);return n.createElement("div",null,n.createElement(s.SectionHeader,{buttonAction:this.toggleShowAll,buttonText:this.buttonText(t),title:d._("Unread"),ueName:"unread"}),n.createElement("div",{className:"home-access-section__content home__unread-items"},o))},t})(_.ReactPureLogger);h.displayName="HomeAccessUnread",t.HomeAccessUnreadInner=h,t.HomeAccessUnread=i.timingComponent(h,r.LoggingSections.UNREAD)}),define("modules/clean/react/home/home_access/unread/store",["require","exports","tslib","external/underscore","modules/clean/flux/dispatcher","modules/clean/flux/flux_store","modules/clean/react/home/constants","modules/clean/react/home/home_access/unread/helpers","modules/clean/react/user_notifications/api","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/store","modules/clean/web_timing_logger","modules/core/exception"],function(e,t,o,n,r,i,a,s,c,l,d,u,m,p){"use strict";function _(){return g||(g=new h),g}Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadActionTypes={ON_UNREAD_PREFETCH:"HOME_UNREAD_STORE_ON_UNREAD_PREFETCH",UPDATE_FROM_NOTIFICATIONS_STORE:"HOME_UNREAD_STORE_UPDATE_FROM_NOTIFICATIONS_STORE"};var h=(function(e){function i(){var o=e.call(this,r)||this;o.listenToUserNotificationsStore=function(){d.loadOnceAndWatch(!0),r.dispatch({type:t.UnreadActionTypes.UPDATE_FROM_NOTIFICATIONS_STORE})},o.keyToNotification={},o.sortedNotifications=[],o.isLoading=!0,o.unreadPrefetchNotifications=null;var n=window,i=n.__REGISTER_UNREAD_PREFETCH_HANDLER;return i?i(function(e){m.waitForTTI().then(o.listenToUserNotificationsStore),o.update(c.parseGetAllResponse(e).notifications,!1),o.unreadPrefetchNotifications=o.sortedNotifications,r.dispatch({type:t.UnreadActionTypes.ON_UNREAD_PREFETCH})},o.listenToUserNotificationsStore):o.listenToUserNotificationsStore(),o}return o.__extends(i,e),i.prototype.verifyUnreadPrefetchIsHeadOfRetrieveUser=function(){var e=this;if(this.unreadPrefetchNotifications){var t=this.unreadPrefetchNotifications.map(function(e){return e.key}),o=this.sortedNotifications.slice(0,t.length).filter(function(e){return t.indexOf(e.key)<0}).map(function(t){return{index:e.sortedNotifications.indexOf(t),type:t.bluenoteNotificationTypeId||"",time:t.feedTime.toUTCString()}});o.length&&p.reportStack("unread prefetch discrepancy",{severity:p.SEVERITY.NONCRITICAL,exc_extra:{pre_tti:this.unreadPrefetchNotifications,post_tti:this.sortedNotifications,mid_stream:o}}),this.unreadPrefetchNotifications=null}},i.prototype.update=function(e,t){var o=this,r=this.isLoading;return this.isLoading=this.isLoading&&t,e.forEach(function(e){s.isValidNotification(e)&&(o.keyToNotification[e.key]=e)}),this.sortedNotifications=n.values(this.keyToNotification).filter(function(e){return e.isUnread}).sort(u.userNotificationComparator),this.verifyUnreadPrefetchIsHeadOfRetrieveUser(),!!e.length||r!==this.isLoading},i.prototype.onUserNotificationsStoreUpdate=function(){this.getDispatcher().waitFor([u.userNotificationsStore.getDispatchToken()]),this.update(u.userNotificationsStore.getAll(),u.userNotificationsStore.isLoading())&&this.__emitChange()},i.prototype.__onDispatch=function(e){switch(e.action.type){case t.UnreadActionTypes.ON_UNREAD_PREFETCH:this.__emitChange();break;case t.UnreadActionTypes.UPDATE_FROM_NOTIFICATIONS_STORE:case l.ActionTypes.LOAD_REQUEST:case l.ActionTypes.LOAD_SUCCESS:case l.ActionTypes.LOAD_FAILURE:case l.ActionTypes.ACKNOWLEDGEMENT_REQUEST:case l.ActionTypes.ACKNOWLEDGEMENT_REQUEST_SINGLE:case l.ActionTypes.MARK_AS_SEEN_REQUEST:this.onUserNotificationsStoreUpdate()}},i.prototype.getNotifications=function(){return this.sortedNotifications},i.prototype.getLoadingState=function(){return this.isLoading?a.LoadingStates.LOADING:a.LoadingStates.SUCCESS},i})(i);t.HomeUnreadStore=h;var g;t.getHomeUnreadStore=_}),define("modules/clean/react/home/incoming/model/core",["require","exports","external/underscore"],function(e,t,o){"use strict";function n(e){return e.replace(/_(.)/g,function(e,t){return t.toUpperCase()})}function r(e){return e.replace(/([a-z\d])([A-Z])/g,function(e,t,o){return t+"_"+o.toLowerCase()})}function i(e,t){return Object.keys(t).forEach(function(o){var n=e(o),r=t[o],a="object"==typeof r&&null!==r?i(e,r):r;if(n!==o||a!==r)try{t[n]=a,delete t[o]}catch(e){}}),t}function a(e,t){void 0===t&&(t={});var n=o.extend({},d,t);return function(t,o){var r=t.constructor.__NAME__;s.__DESERIALIZERS__[r]||(s.__DESERIALIZERS__[r]={}),s.__DESERIALIZERS__[r][o]=function(t){t=n.convertToCamelCase?c(t):l(t);try{return e(t.hasOwnProperty(o)?t[o]:n.defaultValue,t)}catch(e){throw"Error deserializing property `"+o+"` for class `"+r+"`\n"+e}}}}Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e){Object.assign(this,e)}return e.prototype._mergeProps=function(e){var t=o.omit(this,function(e){return e instanceof Function}),n=o.pick(e,Object.keys(t));return o.extend(t,n)},e.prototype.toObject=function(){var t=this._mergeProps({});return o.mapObject(t,function(t){return t instanceof e?t.toObject():t})},e.jsonToProperties=function(t){for(var n=[],r=e.__NAME__,i=this.__NAME__,a=this.prototype;i!==r;)n.unshift(i),a=Object.getPrototypeOf(a),i=a.constructor.__NAME__;for(var s={},c=function(n){var r=e.__DESERIALIZERS__[n];void 0!==r&&o.each(Object.keys(r),function(e){s[e]=r[e](t)})},l=0,d=n;l<d.length;l++){c(d[l])}return s},e})();s.__NAME__="HomeModel",s.__DESERIALIZERS__={},t.HomeModel=s;var c=i.bind(null,n),l=i.bind(null,r),d={convertToCamelCase:!0,defaultValue:void 0};t.deserializer=a}),define("modules/clean/react/home/incoming/model/deserializers",["require","exports"],function(e,t){"use strict";function o(e){return void 0===e||null===e}function n(e,t){if(o(t))return t;var n=typeof t;if(n===e)return t;throw"Expected "+e+", got "+n+" ("+t+")"}function r(e){return n("string",e)}function i(e){return n("number",e)}function a(e){return n("boolean",e)}function s(e){if(o(e))return e;var t=typeof e;if("number"===t)return new Date(e);if(e instanceof Date)return e;throw"Expected Date or number, got "+t+" ("+e+")"}function c(e){return e}function l(e){return function(t){return void 0===t&&(t=[]),t.map(function(t,o){try{return e(t)}catch(e){throw"Error deserializing array at index "+o+"\n"+e}})}}function d(e){return function(t){return new e(void 0===t||null===t?{}:e.jsonToProperties(t))}}Object.defineProperty(t,"__esModule",{value:!0}),t.StringDeserializer=r,t.NumberDeserializer=i,t.BooleanDeserializer=a,t.DateDeserializer=s,t.AnyDeserializer=c,t.ArrayDeserializer=l,t.ClassDeserializer=d}),define("modules/clean/react/home/section_header",["require","exports","tslib","external/react","modules/clean/react_logger","modules/clean/user_education/user_education_client"],function(e,t,o,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(o){return e.call(this,t.displayName,o)||this}return o.__extends(t,e),t.prototype.renderButton=function(){return this.props.buttonText&&this.props.buttonAction?n.createElement("div",{className:"home-section-header__button"},n.createElement("button",{className:"button-as-link",onClick:this.props.buttonAction},this.props.buttonText)):null},t.prototype.render=function(){return n.createElement("h2",{className:"home-access-section__header"},n.createElement("div",{className:"home-access-section__title"},n.createElement("div",{className:"home-access-section__title-text"},n.createElement(i.UserEducationEffect,{containerName:"home-section-header",name:this.props.ueName},this.props.title))),this.renderButton())},t})(r.ReactPureLogger);a.displayName="SectionHeader",t.SectionHeader=a}),define("modules/clean/react/home/starred/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/home/starred/constants","modules/clean/react/home/starred/api","modules/clean/react/home/starred/models/starred_item","modules/clean/react/starred/model","modules/constants/home"],function(e,t,o,n,r,i,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(){}return e.loadInitialItems=function(){return o.dispatch({type:n.StarredResourceActionTypes.LOADING_INITIAL}),e.loadItems(s.HOME_STARRED_NUM_INITIAL_ITEMS)},e.loadAllItems=function(){return o.dispatch({type:n.StarredResourceActionTypes.LOADING_ALL}),e.loadItems(1e3)},e.loadItems=function(e){return r.getItems(e).then(function(e){var t=e.items.map(i.starredItemModelToStarredStatus);o.dispatch({type:n.StarredResourceActionTypes.LOAD_SUCCESS,items:e.items,starredStatuses:a.statusResultsToStarredStatuses(t),hasMore:e.hasMore,hideEmptySection:e.hideEmptySection})}).catch(function(e){return o.dispatch({type:n.StarredResourceActionTypes.LOAD_FAILURE,error:e}),Promise.reject(e)})},e.hideSection=function(e){void 0===e&&(e=!1),o.dispatch({type:n.StarredResourceActionTypes.HIDE_EMPTY_SECTION}),e||r.hideSection()},e})();t.StarredActions=c}),define("modules/clean/react/home/starred/api",["require","exports","modules/clean/react/home/api","modules/clean/react/home/store","modules/clean/react/home/starred/models/starred_item","modules/core/exception"],function(e,t,o,n,r,i){"use strict";function a(e){if("success"===e.status){if(void 0===e.items||void 0===e.has_more||void 0===e.hide_section)throw i.reportStack("Home starred items request returned success without items or hasMore",{severity:i.SEVERITY.NONCRITICAL}),new Error("Invalid server response for Starred getItems");return{items:e.items.map(r.starredItemFromJson),hasMore:e.has_more,hideEmptySection:e.hide_section}}throw e.status}Object.defineProperty(t,"__esModule",{value:!0}),t.getItems=function(e){var t=window.__REGISTER_RETRIEVE_STARRED_PRELOAD_HANDLER;if(t)return delete window.__REGISTER_RETRIEVE_STARRED_PRELOAD_HANDLER,new Promise(function(e,o){t(function(t){e(a(t))},o)});var r=n.HomeStore.getRole();return o.makeRequest({url:"/home_feed/retrieve_starred",type:"POST",data:{role:r,limit:e}},!0).then(a)},t.hideSection=function(){return o.makeRequest({url:"/home_feed/hide_starred_section",type:"POST",data:{role:n.HomeStore.getRole()}})}}),define("modules/clean/react/home/starred/models/starred_item",["require","exports","external/underscore","modules/clean/react/home/constants"],function(e,t,o,n){"use strict";function r(e){return{title:e.title,resourceId:e.resource_id,idType:e.id_type,displayType:e.display_type,url:e.url,details:i(e.display_type,e.details)}}function i(e,t){var o=n.DisplayTypeToResourceType[e];if(o===n.FILE_RESOURCE_TYPE){var r=t;return{fqPath:r.fq_path}}if(o===n.FOLDER_RESOURCE_TYPE){var r=t;return{fqPath:r.fq_path,targetNsId:r.target_ns_id}}return{}}function a(e){return{display_type:e.displayType,resource_id:e.resourceId,id_type:e.idType}}function s(e,t){return o.extend({latestActivity:t},e)}function c(e){return l(a(e))}function l(e){return e.display_type+"|"+e.resource_id}function d(e){return JSON.stringify(e.map(a))}function u(e){return{id:e.resourceId,type:e.idType,is_starred:!0}}Object.defineProperty(t,"__esModule",{value:!0}),t.starredItemFromJson=r,t.detailsFromJson=i,t.getResourceIdProps=a,t.addActivityToItem=s,t.getResourceKeyFromModel=c,t.getResourceKeyFromResourceIdProps=l,t.getResourcesJson=d,t.starredItemModelToStarredStatus=u}),define("modules/clean/react/home/starred/starred_item",["require","exports","tslib","external/classnames","external/mcl/overflow_button","external/react","modules/core/i18n","modules/core/uri","modules/clean/react/bubble_menu","modules/clean/react/home/store","modules/clean/react/home/util/navigation","modules/clean/react/home/util/resource_icon","modules/clean/react/starred/actions","modules/clean/react/starred/star","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/constants","modules/clean/undo","modules/clean/user_education/user_education_client","modules/clean/sharing/async_share_modal_util","modules/clean/react_logger"],function(e,t,o,n,r,i,a,s,c,l,d,u,m,p,_,h,g,y,f,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(R={},R[h.FILE_RESOURCE_TYPE]=!0,R[h.FOLDER_RESOURCE_TYPE]=!0,R[h.PAPER_DOCUMENT_RESOURCE_TYPE]=!0,R),S=(function(e){function t(o){var n=e.call(this,t.displayName,o)||this;return n.getLoggingInfo=function(){var e=h.DisplayTypeToResourceType[n.props.item.displayType],t="n/a";if(e===h.FILE_RESOURCE_TYPE){var o=n.props.item.title,r=o.lastIndexOf(".");t=r===-1?"":o.substr(r+1)}return{resourceId:n.props.item.resourceId,resourceType:e,resourceExt:t,position:n.props.position}},n.onClick=function(e){e.stopPropagation();var t=n.props.item.displayType===h.EXTERNAL_RESOURCE_TYPE;d.logAndNavigate(n.props.item.url,n.logOpen,e,!0,t)},n.onStarClick=function(e){if(!e){var t=n.getLoggingInfo(),o=t.resourceId,r=t.resourceType,i=t.resourceExt,s=t.position;_.homeActivityLogger.logUnstarItem(o,r,i,s);var c=n.props.item,d=a._("Removed from Starred."),u=function(e){var t=e.itemToStar;m.StarredActions.update(l.HomeStore.getRole(),t.resourceId,t.idType,!0,t.title),_.homeActivityLogger.logUndoUnstarItem(o,r,i,s)};g.notifyWithUndo(d,{itemToStar:c},u,10)}},n.logEvent=function(e){var t=n.getLoggingInfo();return e(t.resourceId,t.resourceType,t.resourceExt,t.position)},n.logOpen=function(){return n.logEvent(_.homeActivityLogger.logOpenStarredItem)},n.logClickMenu=function(){return n.logEvent(_.homeActivityLogger.logClickStarOverflowMenu)},n.logClickUpload=function(){return n.logEvent(_.homeActivityLogger.logClickStarOverflowUpload)},n.logClickShare=function(){return n.logEvent(_.homeActivityLogger.logClickStarOverflowShare)},n.redirectToUpload=function(e){d.logAndNavigate(s.parse(n.props.item.url).updateQuery({upload:"1"}).toString(),n.logClickUpload)},n.handleShare=function(e){if(n.props.item.displayType===h.PAPER_DOCUMENT_RESOURCE_TYPE)return void d.logAndNavigate(n.props.item.url+"?openSharing=1",n.logClickShare,e);n.logClickShare();var t=h.DisplayTypeToResourceType[n.props.item.displayType]===h.FOLDER_RESOURCE_TYPE,o=t?n.props.item.details.targetNsId:null;f.asyncShowShareModal(n.props.user,{fqPath:n.props.item.details.fqPath,isFolder:t,targetNsId:o})},n.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},n.getTitle=function(){var e=n.props.item.title,t=a._("Untitled");return e.trim().length?e:t},n}return o.__extends(t,e),t.prototype.renderDropdown=function(){var e=[],t=h.DisplayTypeToResourceType[this.props.item.displayType];t===h.FOLDER_RESOURCE_TYPE&&e.push(i.createElement(c.BubbleMenuItem,{className:"starred-context-menu-item",key:"upload",onClick:this.redirectToUpload},a._("Upload"))),t in v&&e.push(i.createElement(c.BubbleMenuItem,{className:"starred-context-menu-item",key:"share",onClick:this.handleShare},a._("Share")));var s={"aria-label":a._("More actions"),onDoubleClick:function(e){e.stopPropagation()}},l=i.createElement(r.OverflowButton,o.__assign({className:"starred-item__context-menu-button","aria-label":a._("More Actions")},s));return i.createElement("div",{onClick:this.stopEvent,className:n({"starred-item__context-menu-emtpy":!e.length})},i.createElement(c.BubbleMenu,{items:e,arrow_position:"top",position:c.BubbleMenu.POSITIONS.BOTTOM,targetButton:l,onShowDropdown:this.logClickMenu}))},t.prototype.render=function(){var e={"starred-item":!0,"starred-item--last-in-row":this.props.lastInRow,"starred-item--in-last-row":this.props.inLastRow};return i.createElement("li",{style:this.props.width?{width:this.props.width}:{},className:n(e),onClick:this.onClick},i.createElement(u.HomeResourceIcon,{className:"starred-item__file-icon",displayType:this.props.item.displayType,fileName:this.props.item.title,variant:"small"}),i.createElement("div",{className:"starred-item__content"},i.createElement(y.UserEducationEffect,{containerName:"StarredItem",name:"starred-item-"+String(this.props.position)}),i.createElement("a",{onClick:this.onClick,href:this.props.item.url,className:"starred-item__title"},this.getTitle()),i.createElement("div",{className:"starred-item__star"},i.createElement(p.Star,{role:l.HomeStore.getRole(),id:this.props.item.resourceId,idType:this.props.item.idType,itemName:this.props.item.title,onStarClick:this.onStarClick}))),this.renderDropdown())},t})(E.ReactPureLogger);S.displayName="StarredItem",t.StarredItem=S;var R}),define("modules/clean/react/home/starred/starred_resource_store",["require","exports","tslib","external/underscore","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/clean/react/home/starred/constants","modules/clean/react/starred/constants","modules/clean/react/home/starred/actions","modules/clean/react/starred/store","modules/clean/react/starred/id_type_pair","modules/clean/flux/flux_store"],function(e,t,o,n,r,i,a,s,c,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=e.call(this,r)||this;return t.orderedIds=[],t.itemsById={},t.loadingState=i.LoadingStates.LOADING,t.hasMore=!0,t.hideEmptySection=!1,t.areAllRequested=!1,t.isPaperUser=!0,t}return o.__extends(t,e),t.prototype.getStarredStore=function(){return l.StarredStore},t.prototype.getItems=function(){var e=this;return this.orderedIds.map(function(t){return e.itemsById[t]}).filter(function(t){var o={id:t.resourceId,type:t.idType},n=e.getStarredStore().getLoadingState(o),r=e.getStarredStore().getIsStarred(o);return n===s.StarredLoadingState.LOADING||r})},t.prototype.getItem=function(e){return this.itemsById[e]},t.prototype.getLoadingState=function(){return this.loadingState},t.prototype.getHasMore=function(){return this.hasMore},t.prototype.getHideEmptySection=function(){return this.hideEmptySection},t.prototype.getAreAllRequested=function(){return this.areAllRequested},t.prototype.getIsPaperUser=function(){return this.isPaperUser},t.prototype.onItemsLoading=function(){this.loadingState=i.LoadingStates.LOADING},t.prototype.onItemsLoadSuccess=function(e,t,o){var r=this;e.forEach(function(e){var t=e.resourceId;r.itemsById[t]?e=n.extend(e,{latestActivity:r.itemsById[t].latestActivity}):r.orderedIds.push(e.resourceId),r.itemsById[t]=e}),this.loadingState=i.LoadingStates.SUCCESS,this.hasMore=t,this.hideEmptySection=o},t.prototype.onItemsLoadFailure=function(e){this.loadingState=i.LoadingStates.FAILURE,e&&e===a.NOT_PAPER_USER_ERROR&&(this.isPaperUser=!1)},t.prototype.onStatusChange=function(){var e=this;r.waitFor([this.getStarredStore().getDispatchToken()]),this.getStarredStore().getAllStarredPairStrings().map(d.idFromIdTypePairString).filter(function(t){return!e.itemsById.hasOwnProperty(t)}).length&&setTimeout(c.StarredActions.loadAllItems,0)},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case a.StarredResourceActionTypes.LOADING_INITIAL:this.onItemsLoading();break;case a.StarredResourceActionTypes.LOADING_ALL:this.areAllRequested=!0,this.onItemsLoading();break;case a.StarredResourceActionTypes.LOAD_SUCCESS:this.onItemsLoadSuccess(t.items,t.hasMore,t.hideEmptySection);break;case a.StarredResourceActionTypes.LOAD_FAILURE:this.onItemsLoadFailure(t.error);break;case a.StarredResourceActionTypes.HIDE_EMPTY_SECTION:this.hideEmptySection=!0;break;case s.StarredActionTypes.SET_STATUS:this.onStatusChange()}this.__emitChange()},t})(u);t.PrivateStarredResourceStoreClass=m,t.StarredResourceStore=new m}),define("modules/clean/react/home/starred/starred_view",["require","exports","tslib","external/react","external/classnames","external/mcl/tip_card","modules/clean/components/loading_indicator","modules/clean/react/home/section_header","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/constants","modules/clean/react/home/starred/starred_item","modules/core/i18n","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/starred/starred_resource_store","modules/clean/react/home/starred/actions","modules/clean/react/home/util/rendering","modules/clean/react_logger"],function(e,t,o,n,r,i,a,s,c,l,d,u,m,p,_,h,g,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(e){function t(o){var n=e.call(this,t.displayName,o)||this;return n.onStoreUpdate=function(){var e=_.StarredResourceStore.getLoadingState(),t=_.StarredResourceStore.getItems(),o=_.StarredResourceStore.getHasMore(),r=_.StarredResourceStore.getHideEmptySection();if(n.setState({itemModels:t,loadingState:e,hasMore:o,hideEmptySection:r}),e===d.LoadingStates.SUCCESS){c.homeTimingLogger.logTTData(d.LoggingSections.STARRED);var i=g.calculateItemsToShow(n.props.width,t.length,266,416,40,2),a=i.itemsPerRow,s=i.itemWidth,l=i.numRows,u=i.hasHiddenRows;p.homeActivityLogger.logStarredShown(t.length,a,s,l,u,o)}},n.toggleShowAll=function(){var e=!n.state.showAll;p.homeActivityLogger.logClickShowAll("starred",!n.state.showAll),e&&n.state.hasMore&&h.StarredActions.loadAllItems(),n.setState({showAll:e})},n.hideSection=function(){h.StarredActions.hideSection()},n.state=t.getInitialState(),n.removeStoreListener=_.StarredResourceStore.addListener(n.onStoreUpdate),n}return o.__extends(t,e),t.prototype.componentWillMount=function(){e.prototype.componentWillMount.call(this),h.StarredActions.loadInitialItems(),this.props.hideSection&&h.StarredActions.hideSection(!0)},t.prototype.componentWillUnmount=function(){this.removeStoreListener&&this.removeStoreListener()},t.getInitialState=function(){return{showAll:!1,itemModels:[],loadingState:d.LoadingStates.LOADING,hasMore:!1,hideEmptySection:!1}},t.prototype.renderStarredGridItem=function(e,t,o,r,i){return n.createElement(u.StarredItem,{key:e.resourceId,item:e,width:t,lastInRow:o%r===r-1,inLastRow:i<=r+o-o%r,user:this.props.user,position:o})},t.prototype.renderEmptyState=function(){return n.createElement("div",{className:"starred--empty"},n.createElement(i.TipCard,{onDismiss:this.hideSection},m._("When you star items, they’ll show up here for easy access.")))},t.prototype.renderItems=function(e){return e.length?e:this.state.loadingState!==d.LoadingStates.LOADING?this.renderEmptyState():null},t.prototype.buttonText=function(e){return e||this.state.hasMore&&this.state.loadingState===d.LoadingStates.SUCCESS?this.state.showAll?m._("Show less"):m._("Show all"):null},t.prototype.renderLoadingIndicator=function(){return this.state.loadingState===d.LoadingStates.LOADING?n.createElement("div",{className:"home-access__loading-indicator home--loading-indicator"},n.createElement(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER})):null},t.prototype.getItemListToRender=function(){var e=this,t=this.state.itemModels;if(this.props.isListView){var o=t.length>4;o&&!this.state.showAll&&(t=t.slice(0,4));return{items:t.map(function(t,o){return n.createElement(u.StarredItem,{key:t.resourceId,item:t,user:e.props.user,position:o})}),hasHiddenRows:o}}return this.getItemListForGridView(t)},t.prototype.getItemListForGridView=function(e){var t=this,o=g.calculateItemsToShow(this.props.width,e.length,266,416,40,2),n=o.itemsPerRow,r=o.itemWidth,i=o.hasHiddenRows,a=e;return this.state.showAll||(a=a.slice(0,2*n)),{items:a.map(function(e,o){return t.renderStarredGridItem(e,r,o,n,a.length)}),hasHiddenRows:i}},t.prototype.render=function(){var e=this.getItemListToRender(),t=e.items,o=e.hasHiddenRows;if(this.state.loadingState===d.LoadingStates.SUCCESS&&!t.length&&this.state.hideEmptySection||!this.props.isListView&&!this.props.width)return null;var i=r({"starred-grid":!this.props.isListView,"starred-list":this.props.isListView});return n.createElement("div",{className:"starred"},n.createElement(s.SectionHeader,{title:m._("Starred"),ueName:"starred",buttonAction:this.toggleShowAll,buttonText:this.buttonText(o)}),n.createElement("ul",{className:i},this.renderItems(t),this.renderLoadingIndicator()))},t})(y.ReactPureLogger);f.displayName="StarredView",t.StarredView=l.timingComponent(f,d.LoggingSections.STARRED)}),define("modules/clean/react/home/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/flux/flux_store","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/home/constants","modules/clean/viewer"],function(e,t,o,n,r,i,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=e.call(this,n)||this;return t.thumbStore=new i.GenericThumbStore,t}return o.__extends(t,e),t.prototype.getRole=function(){return this.role},t.prototype.getUser=function(){return this.user},t.prototype.getThumbStore=function(){return this.thumbStore},t.prototype.getSectionVisibility=function(){return this.sectionVisibility},t.prototype.setSectionVisibility=function(e){var t=e.section,n=e.visible;this.sectionVisibility[t]!==n&&(this.sectionVisibility=o.__assign({},this.sectionVisibility,(r={},r[t]=n,r)));var r},t.prototype.onInitializeStore=function(e){var t=e.role,o=e.sectionVisibility;this.role=t,this.sectionVisibility=o,this.user=s.get_viewer().get_user_by_role(t)},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case a.HomeActionTypes.INITIALIZE_STORE:this.onInitializeStore(t.payload);break;case a.HomeActionTypes.SET_SECTION_VISIBILITY:this.setSectionVisibility(t.payload)}this.__emitChange()},t})(r);t.HomeStore=new c}),define("modules/clean/react/home/util/avatar_icon",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/react/home/store","modules/clean/react/home/incoming/model/core","modules/clean/react/home/incoming/model/deserializers"],function(e,t,o,n,r,i,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.set=function(o){return new t(e.prototype._mergeProps.call(this,o))},t})(s.HomeModel);l.__NAME__="AvatarIcon",l.deserializer=c.ClassDeserializer(l),o.__decorate([s.deserializer(c.StringDeserializer)],l.prototype,"avatarInitials",void 0),o.__decorate([s.deserializer(c.StringDeserializer)],l.prototype,"avatarUrl",void 0),t.AvatarIconModel=l;var d=(function(e){function t(t){var o=e.call(this)||this;return o.state={avatarImage:a.HomeStore.getThumbStore().get_thumb(t.avatarIcon.avatarUrl),_thumbRequestId:null},o}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.bindAvatarUrl(this.props.avatarIcon)},t.prototype.componentWillUnmount=function(){this.unbindAvatarUrl()},t.prototype.componentWillReceiveProps=function(e){var t=this.props.avatarIcon,o=e.avatarIcon;t.avatarUrl!==o.avatarUrl&&(this.unbindAvatarUrl(),this.bindAvatarUrl(e.avatarIcon))},t.prototype.bindAvatarUrl=function(e){var t=this;if(e.avatarUrl){var o=a.HomeStore.getThumbStore(),n=o.bind_url(e.avatarUrl,{onSuccess:function(){t.setState({avatarImage:o.get_thumb(e.avatarUrl)})}});this.setState({_thumbRequestId:n})}},t.prototype.unbindAvatarUrl=function(){this.state._thumbRequestId&&a.HomeStore.getThumbStore().unbind_url(this.state._thumbRequestId)},t.prototype.render=function(){var e=this.props.avatarIcon,t={alt:"",name:e.avatarInitials||"",dimension:this.props.size,initials:e.avatarInitials||"",shape:"CIRCLE",optionalClass:this.props.className},a=n.createElement(i,o.__assign({},t));return n.createElement(r,o.__assign({},t,{defaultAvatar:a,photoUrl:this.state.avatarImage}))},t})(n.PureComponent);d.displayName="AvatarIcon",t.AvatarIcon=d}),define("modules/clean/react/home/util/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HOME_V1_USER_EDUCATION_STEP_NAMES={START:"start",RECENTLY_VIEWED:"recently_viewed",FILES:"files"},t.DEFAULT_HOME_WIDTH=10}),define("modules/clean/react/home/util/doc_with_avatar_icon",["require","exports","external/react","modules/clean/react/home/util/resource_icon","modules/clean/react/home/util/avatar_icon","modules/clean/avatar/size"],function(e,t,o,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocWithAvatarIcon=function(e){var t=e.avatarIconModel,a=e.displayType,s=e.fileName;return o.createElement("div",{className:"home__doc-with-avatar-icon"},o.createElement(n.HomeResourceIcon,{displayType:a,fileName:s,variant:"small"}),o.createElement(r.AvatarIcon,{avatarIcon:t,className:"home__doc-avatar-icon",size:i.AVATAR_DIMENSION_BY_SIZE.SMALL}))},t.DocWithAvatarIcon.displayName="DocWithAvatarIcon"}),define("modules/clean/react/home/util/logging/activity_logger",["require","exports","tslib","modules/clean/loggers/notification_logger","modules/clean/react/home/api","modules/clean/react/home/store","modules/constants/home","modules/clean/react/home/constants"],function(e,t,o,n,r,i,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(){this.loggedActivity={},this.renderedNotifications={}}return e.prototype.checkAlreadyLoggedAndMark=function(e){var t=this.loggedActivity[e];return this.loggedActivity[e]=!0,Boolean(t)},e.prototype.logNotification=function(e,t,n){if(!t.bluenoteNotificationTypeId||!t.bluenoteObject)return Promise.resolve();var c=s.BluenoteObjectTypeToDisplayType[t.bluenoteObject.type],l=s.DisplayTypeToResourceType[c],d={entry_created:t.feedTime.getTime(),notification_type:t.bluenoteNotificationTypeId,resource_type:l,target_object_key:t.targetObjectKey},u=o.__assign({},d,n);return r.logHomeActivity({eventName:e,extra:u,entryType:a.HOME_EVENT_TYPE.UNREAD_BLUENOTE_EVENT,role:i.HomeStore.getRole()})},e.prototype.reset=function(){this.loggedActivity={}},e.prototype.logClickShowAll=function(e,t){return r.logHomeActivity({eventName:s.LoggingTypes.CLICK_SHOW_ALL,role:i.HomeStore.getRole(),extra:{component_name:e,should_show_all:t}})},e.prototype.logHomePageShown=function(){if(!this.checkAlreadyLoggedAndMark(s.LoggingTypes.HOME_PAGE_SHOWN))return r.logHomeActivity({eventName:s.LoggingTypes.HOME_PAGE_SHOWN,role:i.HomeStore.getRole(),extra:{}})},e.prototype.logUnreadShown=function(e,t,o,n,a){if(!this.checkAlreadyLoggedAndMark(s.LoggingTypes.UNREAD_SHOWN))return r.logHomeActivity({eventName:s.LoggingTypes.UNREAD_SHOWN,role:i.HomeStore.getRole(),extra:{num_items:e,is_hidden:!1,items_per_row:t,item_width:o,num_rows:n,has_hidden_rows:a}})},e.prototype.logStarredShown=function(e,t,o,n,a,c){if(!this.checkAlreadyLoggedAndMark(s.LoggingTypes.STARRED_SHOWN))return r.logHomeActivity({eventName:s.LoggingTypes.STARRED_SHOWN,role:i.HomeStore.getRole(),extra:{num_items:e,is_hidden:!1,items_per_row:t,item_width:o,num_rows:n,has_hidden_rows:a,has_more:c}})},e.prototype.logRecentsShown=function(e,t,o){if(!this.checkAlreadyLoggedAndMark(s.LoggingTypes.RECENTS_SHOWN))return r.logHomeActivity({
eventName:s.LoggingTypes.RECENTS_SHOWN,role:i.HomeStore.getRole(),extra:{is_hidden:o,num_metaserver_items:e,num_paper_items:t}})},e.prototype.logShowHideSection=function(e,t){return r.logHomeActivity({eventName:t?s.LoggingTypes.HIDE_SECTION:s.LoggingTypes.UNHIDE_SECTION,role:i.HomeStore.getRole(),extra:{section_name:e}})},e.prototype.logRecentsAction=function(e,t,o,n,a,c){return r.logHomeActivity({eventName:s.LoggingTypes.RECENTS_ITEM_ACTION,role:i.HomeStore.getRole(),extra:{action_taken:e,scope:t,item_number:o,extension:n,sprite:a,subgroup_position:c}})},e.prototype.logOpenUnreadNotificationItem=function(e,t,o,r){n.NotificationLogger.logAction(e,"surface",n.NotificationLocations.HOME_PAGE);var i=s.LoggingTypes.OPEN_UNREAD_ITEM,a={source:t,click_origin:o,position:r};return this.logNotification(i,e,a)},e.prototype.logMarkNotificationAsRead=function(e,t){n.NotificationLogger.logMarkAsRead([e],n.NotificationLocations.HOME_PAGE);var o=s.LoggingTypes.MARK_AS_READ,r={position:t};return this.logNotification(o,e,r)},e.prototype.logRenderedNotifications=function(e){var t=this,o=e.filter(function(e){return e.id&&!t.renderedNotifications[e.id]});0!==o.length&&(o.forEach(function(e){t.renderedNotifications[e.id]=!0}),n.NotificationLogger.logRender(o,-1,n.NotificationLocations.HOME_PAGE))},e.prototype.logOpenStarredItem=function(e,t,o,n){return r.logHomeActivity({eventName:s.LoggingTypes.OPEN_STARRED_ITEM,role:i.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:o,position:n}})},e.prototype.logUnstarItem=function(e,t,o,n){return r.logHomeActivity({eventName:s.LoggingTypes.UNSTAR_ITEM,role:i.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:o,position:n}})},e.prototype.logUndoUnstarItem=function(e,t,o,n){return r.logHomeActivity({eventName:s.LoggingTypes.UNDO_UNSTAR_ITEM,role:i.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:o,position:n}})},e.prototype.logClickStarOverflowMenu=function(e,t,o,n){return r.logHomeActivity({eventName:s.LoggingTypes.CLICK_STAR_OVERFLOW_MENU,role:i.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:o,position:n}})},e.prototype.logClickStarOverflowShare=function(e,t,o,n){return r.logHomeActivity({eventName:s.LoggingTypes.CLICK_STAR_OVERFLOW_SHARE,role:i.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:o,position:n}})},e.prototype.logClickStarOverflowUpload=function(e,t,o,n){return r.logHomeActivity({eventName:s.LoggingTypes.CLICK_STAR_OVERFLOW_UPLOAD,role:i.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:o,position:n}})},e.prototype.logClickRightMenu=function(e,t){var o=t?{modalSessionId:t}:{};return r.logHomeActivity({eventName:e,role:i.HomeStore.getRole(),extra:o})},e})();t.HomeActivityLogger=c,t.homeActivityLogger=new c}),define("modules/clean/react/home/util/logging/timing_component",["require","exports","tslib","external/react","modules/clean/react/home/util/logging/timing_logger"],function(e,t,o,n,r){"use strict";function i(e,t){return(function(i){function a(e){var t=i.call(this,e)||this;return r.homeTimingLogger.activate(),t}return o.__extends(a,i),a.prototype.componentDidMount=function(){r.homeTimingLogger.logTTI(t);var e=this.refs.wrapped,o=e.componentDidUpdate;e.componentDidUpdate=function(){r.homeTimingLogger.logTTI(t),o&&o.call(e)}},a.prototype.render=function(){return n.createElement(e,o.__assign({ref:"wrapped"},this.props))},a})(n.PureComponent)}Object.defineProperty(t,"__esModule",{value:!0}),t.timingComponent=i}),define("modules/clean/react/home/util/logging/timing_logger",["require","exports","modules/clean/js_client_stopwatch","modules/clean/web_timing_logger","modules/clean/react/home/util/logging/timing_state","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/constants","modules/core/exception"],function(e,t,o,n,r,i,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(){this.timingStates=new r.HomeTimingStates,this.logEnsurerHandle=null}return e.prototype.validateActivated=function(e,t){return null!==this.logEnsurerHandle||(s.reportStack("Did not activate when "+e+" before logging "+t,{severity:s.SEVERITY.NONCRITICAL}),!1)},e.prototype.registerLoadCallback=function(e,t){var o=-1;this.triggerPageLoad=function(){clearTimeout(o),e()};var r=n.time_since_start()||2e3;o=setTimeout(this.triggerPageLoad,Math.max(t-r,0))},e.prototype.activate=function(){var e=this;null===this.logEnsurerHandle&&(o.JSStopwatch.create_stopwatch_if_not_exist("home_access_tti"),this.logEnsurerHandle=setTimeout(function(){return s.reportException({err:new Error("Some Home sections did not log TTI after 60 seconds"),tags:["js:home"],exc_extra:{unlogged_components:e.timingStates.getSectionsPreTTI()}})},o.JSStopwatch.flush_interval))},e.prototype.logTTData=function(e){if(this.validateActivated(e,r.HomeTimingState.TTDATA)){this.timingStates.progressState(e,r.HomeTimingState.TTDATA)&&(a.LoggingSectionXHRs[e].forEach(function(e){return n.log_resource_timing(e)}),this.timingStates.haveAllSectionsReachedState(r.HomeTimingState.TTDATA)&&n.log_js_modules_fetched_data_required_for_tti())}},e.prototype.logTTI=function(e){if(this.validateActivated(e,r.HomeTimingState.TTI)){this.timingStates.progressState(e,r.HomeTimingState.TTI)&&(i.homeActivityLogger.logHomePageShown(),o.JSStopwatch.recordTrace(e,{stopwatchName:"home_access_tti"}),this.timingStates.haveAllSectionsReachedState(r.HomeTimingState.TTI)&&(this.triggerPageLoad&&this.triggerPageLoad(),n.mark_time_to_interactive(),o.JSStopwatch.flush_current_data(),clearTimeout(this.logEnsurerHandle)))}},e})();t._HomeTimingLogger=c,t.homeTimingLogger=new c}),define("modules/clean/react/home/util/logging/timing_state",["require","exports","external/underscore","modules/clean/react/home/constants"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;(function(e){e[e.INIT=0]="INIT",e[e.TTDATA=1]="TTDATA",e[e.TTI=2]="TTI"})(r=t.HomeTimingState||(t.HomeTimingState={}));var i=(function(){function e(){var e=this;this.loggingSectionToState={},o.values(n.LoggingSections).forEach(function(t){return e.loggingSectionToState[t]=r.INIT})}return e.prototype.progressState=function(e,t){return this.loggingSectionToState[e]+1===t&&(this.loggingSectionToState[e]=t,!0)},e.prototype.getSectionsPreTTI=function(){return Object.keys(o.pick(this.loggingSectionToState,function(e){return e!==r.TTI}))},e.prototype.haveAllSectionsReachedState=function(e){return o.every(this.loggingSectionToState,function(t){return t>=e})},e})();t.HomeTimingStates=i}),define("modules/clean/react/home/util/navigation",["require","exports","modules/core/browser"],function(e,t,o){"use strict";function n(e){return e.metaKey||e.ctrlKey}function r(e,t,r,i,a){void 0===i&&(i=!0),void 0===a&&(a=!1);var s=!1;r&&(r.preventDefault(),s=!(i||n(r))),s||(a?o.unsafe_open_tab(e):o.open_tab(e)),t().then(function(){s&&o.redirect(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.logAndNavigate=r}),define("modules/clean/react/home/util/rendering",["require","exports"],function(e,t){"use strict";function o(e,t,o,n,r,i){var a=[0,0,0,!1],s=a[0],c=a[1],l=a[2],d=a[3];if(e){var u=Math.floor((e+r)/(o+r));s=Math.max(1,Math.min(t,u)),c=(e-r*(s-1))/s,c=Math.max(o,Math.min(c,n)),l=Math.ceil(t/s),d=l>i}return{itemsPerRow:s,itemWidth:c,numRows:l,hasHiddenRows:d}}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateItemsToShow=o}),define("modules/clean/react/home/util/resource_icon",["require","exports","tslib","external/react","external/mcl/icon_content","external/mcl/file_icon","modules/clean/react_logger","modules/clean/react/home/constants","modules/clean/react/sprite","modules/constants/home"],function(e,t,o,n,r,i,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(o){return e.call(this,t.displayName,o)||this}return o.__extends(t,e),t.prototype.renderIcon=function(){if(s.DisplayTypeToResourceType[this.props.displayType]===s.FILE_RESOURCE_TYPE)return n.createElement(i.FileIcon,{path:this.props.fileName,variant:this.props.variant});var e=s.DisplayTypeToIconName[this.props.displayType]||"unknown";return n.createElement(r.IconContent,{name:e+"-"+this.props.variant})},t.prototype.render=function(){return l.HOME_BETA_NEW_ICONS?n.createElement("span",{className:this.props.className},this.renderIcon()):n.createElement(c,{className:this.props.className,group:"web",name:s.DisplayTypeToSpriteName[this.props.displayType],alt:""})},t})(a.ReactPureLogger);d.displayName="HomeResourceIcon",t.HomeResourceIcon=d}),define("modules/clean/react/home/util/static_tooltip",["require","exports","external/react","external/react-dom","modules/clean/react/bubble_dropdown_v2","modules/clean/react/sprite","modules/core/i18n"],function(e,t,o,n,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(){var e=this;this.isTooltipTriggered=!1,this.onTooltipTriggerRendered=function(t){e.isTooltipTriggered||(e.isTooltipTriggered=!0,e.triggerButton=t,e.simulateTriggerButtonClick())},this.simulateTriggerButtonClick=function(){e.triggerButton.click()},this.show=function(t,s,c,l,d,u,m){void 0===m&&(m="");var p=o.createElement("button",{className:"home-tooltip__trigger-button",ref:e.onTooltipTriggerRendered,"aria-label":"close"}),_=o.createElement(r,{className:"home-tooltip",position:l,targetButton:p,onShowDropdown:d||function(){},onHideDropdown:u||function(){}},o.createElement("h4",{className:"home-tooltip__title"},t),s,o.createElement("button",{className:"home-tooltip__close-button",onClick:e.simulateTriggerButtonClick,"aria-label":a._("Close tooltip")},o.createElement(i,{group:"web",name:"lightbox_close",alt:a._("Close")}))),h=e.createMountingElement(m);c.appendChild(h),n.render(_,h)},this.hide=function(){e.simulateTriggerButtonClick()}}return e.prototype.createMountingElement=function(e){var t=document.createElement("DIV");return e&&(t.className=e),t.addEventListener("click",function(e){e.preventDefault()}),t},e})();s.POSITIONS=r.POSITIONS,t.StaticTooltip=s}),define("modules/clean/recent_activity/actions/federated_recent_activity_actions",["require","exports","modules/core/i18n","modules/core/browser","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_federated_model","modules/clean/recent_activity/stores/federated_recent_activity_store","modules/core/exception","modules/core/notify","modules/clean/react/home/home_access/recents/utils/events","modules/clean/recent_activity/recent_activity_logger"],function(e,t,o,n,r,i,a,s,c,l,d,u,m,p){"use strict";function _(e,t,o){e?n.open_tab(e):d.reportStack("Cannot open tab to preform the action "+t,{severity:d.SEVERITY.NONCRITICAL,exc_extra:{paperRecentItem:o.paperRecentItem}})}function h(e,t,o){m.logEvent(e,o.cellView,[t.getFqPath()],1,1)}function g(e,t){h(p.ActionTypes.PAPER_SHARE,e,t),_(c.getPaperShareUrl(e),p.ActionTypes.PAPER_SHARE,e)}function y(e,t){h(p.ActionTypes.PAPER_OPEN,e,t),_(e.getUrl(),p.ActionTypes.PAPER_OPEN,e)}function f(e,t){a.recentActivityDispatcher.dispatch({type:e,activityKey:t})}function E(e,t,n){var a=e.getActivityKey();if(l.FederatedRecentActivityStore.canArchiveActivityKey(a)){var d=e.getActivityKey();r.SimpleModal.show({title_text:o._("Archive document?"),body_html:o._("Do you want to archive this document?"),confirm_text:o._("Archive"),cancel_text:o._("Cancel"),autoclose:!0,confirm_callback:function(){h(p.ActionTypes.PAPER_ARCHIVE,e,n),f(i.ARCHIVE_PAPER_DOCUMENT_PENDING,d),s.archivePaperResources(t,[e.paperRecentItem]).then(function(t){t.some(function(t){return c.equalsPaperRecentItem(e,t)})?(f(i.ARCHIVE_PAPER_DOCUMENT_COMMIT,d),u.success(o._("The document was archived."))):f(i.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,d)},function(){return f(i.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,d)})}})}}Object.defineProperty(t,"__esModule",{value:!0}),t.shareItem=g,t.previewItem=y,t.promptAndArchiveItem=E}),define("modules/clean/recent_activity/models/federated_recent_item",["require","exports","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_federated_model"],function(e,t,o,n){"use strict";function r(e,t,r){var i=new n.FederatedRecentItem(e),a=i.getActivityKey();return{federatedRecentItem:i,id:a,idType:e.id_type,resourceId:e.resource_id,type:o.RECENT_EVENT_TYPES.PAPER_VIEW,icon:i.getIcon(),when:e.time,viewingUserId:t.id,displayName:e.name,accountDisplayName:t.display_name,contextDisplayName:i.getFolderPath()||t.display_name,attachmentIds:[a],paths:e.path,order:r,uniqueFilterTypes:[o.RECENT_EVENT_FILTER_TYPE.DOCUMENTS]}}Object.defineProperty(t,"__esModule",{value:!0}),t.createRecentItemFromPaperRecentItem=r}),define("modules/clean/recent_activity/react/recent_activity_empty_state",["require","exports","external/react","modules/core/i18n"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecentActivityEmptyState=function(){return o.createElement("div",{className:"recents-empty_state",key:"empty_state"},o.createElement("div",{className:"recents-empty_state_image"}),o.createElement("div",{className:"recents-empty_state_heading"},n._("Items you recently viewed will show up here.")))},t.RecentActivityEmptyState.displayName="RecentActivityEmptyState"}),define("modules/clean/recent_activity/recent_activity_federated_model",["require","exports","modules/clean/recent_activity/recent_activity_constants"],function(e,t,o){"use strict";function n(e){return e.paperRecentItem.type===o.PaperRecentItemTypes.DOCUMENT}function r(e){return e.paperRecentItem.type===o.PaperRecentItemTypes.PROJECT}function i(e){return n(e)?e.paperRecentItem.shareUrl||"":""}function a(e,t){return e.paperRecentItem.id===t.id&&e.paperRecentItem.type===t.type}Object.defineProperty(t,"__esModule",{value:!0}),t.isPaperDocument=n,t.isPaperProject=r,t.getPaperShareUrl=i,t.equalsPaperRecentItem=a;var s=(function(){function e(e){this.paperRecentItem=e}return e.prototype.isShareable=function(){return n(this)&&!!i(this)},e.prototype.isArchiveable=function(){return n(this)&&!!this.paperRecentItem.isEditable},e.prototype.hasMenuActions=function(){return this.isArchiveable()},e.prototype.getIdTypePair=function(){return{id:this.paperRecentItem.resource_id,type:this.paperRecentItem.id_type}},e.prototype.getStarredStatus=function(){return{starred:this.paperRecentItem.isFavorite,idTypePair:this.getIdTypePair()}},e.prototype.getIcon=function(){switch(this.paperRecentItem.display_type){case"PAPER_DOCUMENT":return"paper_doc";case"PAPER_FOLDER":return"folder";case"PAPER_PUBLIC_FOLDER":return"folder_team";case"PAPER_PROJECT":return"paper_project";default:return"file"}},e.prototype.getFolderPath=function(){return[""].concat(this.paperRecentItem.path.map(function(e){return e.name})).join("/")},e.prototype.getFqPath=function(){return this.getFolderPath()+"/"+this.paperRecentItem.name},e.prototype.getActivityKey=function(){return"paper_id_"+this.paperRecentItem.id},e.prototype.getUrl=function(){return this.paperRecentItem.url},e})();t.FederatedRecentItem=s}),define("modules/clean/recent_activity/recent_activity_starred",["require","exports","external/underscore","modules/clean/flux/dispatcher","modules/clean/react/starred/constants","modules/clean/react/starred/id_type_pair","modules/clean/react/starred/actions","modules/clean/recent_activity/recent_activity_federated_model","modules/clean/viewer"],function(e,t,o,n,r,i,a,s,c){"use strict";function l(e){e.length&&n.dispatch({type:r.StarredActionTypes.SET_STATUS,starredStatuses:e.map(function(e){return new s.FederatedRecentItem(e).getStarredStatus()})})}function d(e,t){var o=m(t);if(o.length){var n=c.get_viewer().get_user_by_id(e);a.StarredActions.fetchStatuses(n.role,o,!0)}}function u(e){return e.resource_id&&e.id_type?{id:e.resource_id,type:e.id_type}:null}function m(e){var t={};return e.forEach(function(e){var o=u(e);o&&(t[i.idTypePairToString(o)]=o)}),o.values(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.setStarredStatusOfPaperRecentItems=l,t.fetchStarredStatus=d,t.getIdTypePair=u,t.getIdTypePairsByRecentActivityItems=m}),define("modules/clean/recent_activity/recent_activity_stream",["require","exports","external/underscore","modules/clean/recent_activity/models/utils"],function(e,t,o,n){"use strict";function r(e){var t=e.filter(Boolean),r=o.max(t.map(function(e){return e.oldestTimeForOtherStream}));return(i=[]).concat.apply(i,t.map(function(e){return e.getItemsAfter(r)})).sort(n.compareRecentItems);var i}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e,t){var o=this;this.sortedRecentItems=e,this.hasMore=t,this.activityKeyToRecentItem={},e.forEach(function(e){o.activityKeyToRecentItem[e.id]=e}),this.oldestTimeForOtherStream=this.getOldestItemTimeForOtherStreams()}return e.prototype.getOldestItemTimeForOtherStreams=function(){return this.hasMore&&this.sortedRecentItems.length?this.sortedRecentItems[this.sortedRecentItems.length-1].when||0:0},e.prototype.getRecentItems=function(){return this.sortedRecentItems.slice()},e.prototype.getRecentItemByActivityKey=function(e){return this.activityKeyToRecentItem[e]||null},e.prototype.getStreamWithoutActivityKey=function(t){return new e(this.sortedRecentItems.filter(function(e){return e.id!==t}),this.hasMore)},e.prototype.getItemsAfter=function(e){if(this.oldestTimeForOtherStream<e){for(var t=[],o=0,n=this.sortedRecentItems;o<n.length;o++){var r=n[o];if(r.when<e)break;t.push(r)}return t}return this.sortedRecentItems},e})();t.RecentActivityStream=i,t.getMergedRecentItems=r}),define("modules/clean/recent_activity/stores/federated_recent_activity_store",["require","exports","tslib","external/underscore","modules/clean/react/home/constants","modules/clean/react/home/util/logging/timing_logger","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/models/federated_recent_item","modules/clean/recent_activity/recent_activity_starred","modules/clean/recent_activity/recent_activity_stream","modules/clean/viewer","modules/core/exception","modules/clean/flux/flux_store"],function(e,t,o,n,r,i,a,s,c,l,d,u,m,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=e.call(this,s.recentActivityDispatcher)||this;return t.federatedOriginToRecentActivityStream={},t.didReceiveRawRecentActivities=!1,t.activityKeyToPendingDeletion={},t}return o.__extends(t,e),t.prototype.didReceiveItemsFromAllStreams=function(){return this.didReceiveRawRecentActivities&&n.size(this.federatedOriginToRecentActivityStream)>0},t.prototype.getRecentActivityStreams=function(){return n.values(this.federatedOriginToRecentActivityStream)},t.prototype.canArchiveActivityKey=function(e){return this.mapFederatedRecentItem(e,function(e){return e.isArchiveable()},!1)&&!this.activityKeyToPendingDeletion[e]},t.prototype.logTtd=function(){this.didReceiveItemsFromAllStreams()&&i.homeTimingLogger.logTTData(r.LoggingSections.RECENTS)},t.prototype.mapFederatedRecentItem=function(e,t,o){return this.mapRecentItem(e,function(e){return e.federatedRecentItem?t(e.federatedRecentItem):o},o)},t.prototype.mapRecentItem=function(e,t,o){var n=this.getRecentItemByActivityKey(e);return n?t(n):o},t.prototype.accessRecentActivityStream=function(e,t){e in this.federatedOriginToRecentActivityStream&&t(this.federatedOriginToRecentActivityStream[e])},t.prototype.getRecentItemByActivityKey=function(e){var t=this,o=[];return n.values(a.FederatedOrigins).forEach(function(n){t.accessRecentActivityStream(n,function(t){var n=t.getRecentItemByActivityKey(e);n&&o.push(n)})}),m.reportStack("activity key matches multiple items.",{severity:m.SEVERITY.NONCRITICAL,exc_extra:{recentItems:o}}),o.length?o[0]:null},t.prototype.onReceiveRawRecentActivity=function(e){var t=e.userId,o=e.rawRecentActivities;l.fetchStarredStatus(t,n.values(o)),this.didReceiveRawRecentActivities=!0,this.logTtd()},t.prototype.onReceivePaperRecentItems=function(e,t,o){var n=u.get_viewer().get_user_by_id(o),r=e.map(function(e,t){return c.createRecentItemFromPaperRecentItem(e,n,t)});this.federatedOriginToRecentActivityStream[a.FederatedOrigins.PAPER]=new d.RecentActivityStream(r,t),l.setStarredStatusOfPaperRecentItems(e),this.logTtd()},t.prototype.onArchivePaperDocumentPending=function(e){this.activityKeyToPendingDeletion[e]=!0},t.prototype.onArchivePaperDocumentCommit=function(e){var t=this;delete this.activityKeyToPendingDeletion[e],this.accessRecentActivityStream(a.FederatedOrigins.PAPER,function(o){t.federatedOriginToRecentActivityStream[a.FederatedOrigins.PAPER]=o.getStreamWithoutActivityKey(e)})},t.prototype.onArchivePaperDocumentRollback=function(e){delete this.activityKeyToPendingDeletion[e]},t.prototype.__onDispatch=function(e){switch(e.type){case a.RECEIVE_PAPER_RECENT_ITEMS:this.onReceivePaperRecentItems(e.items,e.hasMore,e.userId);break;case a.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivity(e);break;case a.ARCHIVE_PAPER_DOCUMENT_PENDING:this.onArchivePaperDocumentPending(e.activityKey);break;case a.ARCHIVE_PAPER_DOCUMENT_COMMIT:this.onArchivePaperDocumentCommit(e.activityKey);break;case a.ARCHIVE_PAPER_DOCUMENT_ROLLBACK:this.onArchivePaperDocumentRollback(e.activityKey);break;default:return}this.__emitChange()},t})(p);t.FederatedRecentActivityStoreClass=_,t.FederatedRecentActivityStore=new _}),define("modules/clean/recent_activity/stores/recent_activity_cache",["require","exports","tslib","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/recent_activity/stores/federated_recent_activity_store","modules/clean/recent_activity/versions/recent_activity_version_shared","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_stream","modules/clean/web_timing_logger","modules/clean/flux/flux_store"],function(e,t,o,n,r,i,a,s,c,l,d,u){"use strict";function m(){return null===_&&(_=new p),_}Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=e.call(this,n.recentActivityDispatcher)||this;return t.userIdAndFilterTypeToRecentItems={},t.recentItemsCountMax=c.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI,d.waitForTTI().then(function(){return t.recentItemsCountMax=c.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI}),t}return o.__extends(t,e),t.prototype.shouldTruncateRecentItems=function(e){return e.length>this.recentItemsCountMax},t.prototype.getRecentItemsFromAllStreams=function(e,t){var o=a.FederatedRecentActivityStore.getRecentActivityStreams();return o.push(new l.RecentActivityStream(s.getRecentItemsFromAntenna(e,t),!!i.recentActivityStore.cursorForUser(e))),l.getMergedRecentItems(o)},t.prototype.clearCache=function(){this.userIdAndFilterTypeToRecentItems={}},t.prototype.__onDispatch=function(e){switch(e.type){case r.RECEIVE_PAPER_RECENT_ITEMS:case r.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:case r.RECEIVE_RAW_RECENT_ACTIVITIES:case r.DELETE_FILES_COMMIT:case r.ARCHIVE_PAPER_DOCUMENT_COMMIT:this.clearCache();break;default:return}this.__emitChange()},t.prototype.getAllRecentItems=function(e,t){var o=e+":"+t;return this.userIdAndFilterTypeToRecentItems.hasOwnProperty(o)||(this.userIdAndFilterTypeToRecentItems[o]=this.getRecentItemsFromAllStreams(e,t)),this.userIdAndFilterTypeToRecentItems[o]},t.prototype.getRecentItems=function(e,t){var o=this.getAllRecentItems(e,t);return this.shouldTruncateRecentItems(o)?o.slice(0,this.recentItemsCountMax):o},t.prototype.shouldLoadMore=function(e,t){return!this.shouldTruncateRecentItems(this.getAllRecentItems(e,t))},t})(u);t.RecentActivityCache=p;var _=null;t.getRecentActivityCache=m}),define("modules/clean/recent_activity/versions/recent_activity_actions_menu_version_2",["require","exports","external/classnames","external/mcl/overflow_button","external/react","modules/core/i18n","modules/clean/react/bubble_menu","modules/clean/react/sprite_div","modules/clean/recent_activity/versions/recent_activity_version_shared"],function(e,t,o,n,r,i,a,s,c){"use strict";function l(e,t,o,n){return r.createElement(a.BubbleMenuItem,{className:"recents-actions-list__item recents-actions-list__item--"+e,key:e,onClick:n},r.createElement(s,{group:"web",name:o,text:t,alt:""}))}function d(e){var t=e.props.permissions;return[e.canOpen()?l("open",c.ACTION_LABELS.OPEN,"open",e.onOpen):null,t.download?l("download",e.getDownloadLabel(),"open",e.onDownload):null,t.comment?l("comment",c.ACTION_LABELS.COMMENT,"s_file_comment",e.onComment):null,t.delete?l("delete",e.getDeleteLabel(),"delete_16",e.onDelete):null,t.archive?l("archive",c.ACTION_LABELS.ARCHIVE,"delete_16",e.onArchive):null,t.versions?l("versions",c.ACTION_LABELS.VERSION,"previous_versions",e.onVersions):null,e.canSelect()?l("select",c.ACTION_LABELS.SELECT,"select",e.onSelectAll):null,e.canDeselect()?l("deselect",c.ACTION_LABELS.DESELECT,"deselect",e.onDeselectAll):null].filter(Boolean)}function u(e){var t=o({"recents-item__actions-button":!0,"button-secondary":!0,disabled:e.props.disableActions});return r.createElement(n.OverflowButton,{className:t,"aria-label":i._("More Actions"),tabIndex:0})}function m(e){return e.props.disableActions?u(e):r.createElement(a.BubbleMenu,{targetButton:u(e),arrow_position:"top",bubbleDropdownShown:e.props.tooltipHandler.onShowTooltip,bubbleDropdownHidden:e.props.tooltipHandler.onHideTooltip,items:d(e),position:a.BubbleMenu.POSITIONS.BOTTOM,ref:"moreActionDropdown"})}Object.defineProperty(t,"__esModule",{value:!0}),t.renderMoreActionsButton=m}),define("modules/clean/recent_activity/versions/recent_activity_version_2",["require","exports","tslib","external/react","modules/clean/recent_activity/actions/federated_recent_activity_actions","modules/clean/browse_interface","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/react/recent_activity_empty_state","modules/clean/recent_activity/recent_activity_prefetch","modules/clean/recent_activity/react/recent_activity_list_view","modules/clean/recent_activity/stores/recent_activity_cache","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/stores/federated_recent_activity_store","modules/clean/react/home/home_access/recents/utils/events","modules/clean/recent_activity/recent_activity_logger","modules/clean/react/starred/store","modules/core/exception","modules/clean/react/starred/star","modules/clean/react/home/store","modules/clean/recent_activity/recent_activity_constants","modules/clean/react/home/util/navigation","modules/clean/react/sprite","modules/clean/recent_activity/versions/recent_activity_version_shared","modules/clean/recent_activity/versions/recent_activity_actions_menu_version_2"],function(e,t,o,n,r,i,a,s,c,l,d,u,m,p,_,h,g,y,f,E,v,S,R,T,A){"use strict";function I(e,t){return 1===t.length?t[0]:0===t.length&&1===e.attachmentIds.length?s.attachmentStore.getById(e.attachmentIds[0]):null}function N(e,t){return e.fqPath?String(i.preview_uri_for_fq_path(t,e.fqPath)):e.previewInfo?e.previewInfo.href||null:null}function O(e,t,o){var n=s.attachmentStore.getByIds(t).map(function(e){return e.fqPath}).filter(Boolean);return _.logEvent(e,o.cellView,n,o.totalCount)}function P(e,t,o,n,r){S.logAndNavigate(e,function(){return O(t,o,n)},r,!0)}function C(e,t,o){var n=N(e,E.HomeStore.getUser());return!!n&&(P(n,h.ActionTypes.VIEW_FILE,t,o),!0)}function b(e,t,o,n){if(e.federatedRecentItem)r.previewItem(e.federatedRecentItem,o);else{var i=E.HomeStore.getUser(),a=I(e,t);a?m.ensureAttachments(i.id,[a.id],function(t){if(1===t.length){if(C(t[0],e.attachmentIds,o))return}n()}):n()}}function L(e){return e.resourceId&&e.idType?{id:e.resourceId,type:e.idType}:null}Object.defineProperty(t,"__esModule",{value:!0});var D=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.renderStar=function(e,t){var o=L(t);return o?n.createElement(f.Star,{id:o.id,idType:o.type,role:e}):null},t.prototype.logEvent=function(e,t,o,n,r){_.logEvent(e,t,o,n,r)},t.prototype.renderEmptyState=function(e){return n.createElement(c.RecentActivityEmptyState,null)},t.prototype.maybeRenderSelectAllButton=function(){return null},t.prototype.getRemoveStoreListeners=function(t){var o=e.prototype.getRemoveStoreListeners.call(this,t),n=g.StarredStore.addListener(t),r=p.FederatedRecentActivityStore.addListener(t),i=u.getRecentActivityCache().addListener(t);return function(){o(),n(),r(),i()}},t.prototype.getRecentItems=function(e,t){return p.FederatedRecentActivityStore.didReceiveItemsFromAllStreams()?u.getRecentActivityCache().getRecentItems(e,t):[]},t.prototype.didReceiveRecentActivities=function(){return p.FederatedRecentActivityStore.didReceiveItemsFromAllStreams()},t.prototype.isStoreReadyForUserId=function(e,t){return this.didReceiveRecentActivities()},t.prototype.loadPreFetchedPage=function(e){l.preloadRecentItems(e,!0)},t.prototype.loadPage=function(t,o){void 0===o&&(o=!1),e.prototype.loadPage.call(this,t,o),m.loadPaperRecentItems(t,!0,o)},t.prototype.shareRecentItem=function(t,o,n){t.federatedRecentItem?r.shareItem(t.federatedRecentItem,n):e.prototype.shareRecentItem.call(this,t,o,n)},t.prototype.previewOrBrowseRecentItem=function(t,o,n,r){var i=this;b(t,o,r,function(){e.prototype.previewOrBrowseRecentItem.call(i,t,o,n,r)})},t.prototype.previewRecentItem=function(e,t,o,n){b(e,t,n,function(){y.reportStack("Failed to preview the RecentItem",{severity:y.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e,attachments:t,previewOptions:o}})})},t.prototype.deleteRecentItem=function(t,o,n){t.federatedRecentItem?y.reportStack("Deleting is not supported for federated recent items",{severity:y.SEVERITY.NONCRITICAL,exc_extra:{recentItem:t}}):e.prototype.deleteRecentItem.call(this,t,o,n)},t.prototype.archiveRecentItem=function(t,o){t.federatedRecentItem?r.promptAndArchiveItem(t.federatedRecentItem,t.viewingUserId,o):e.prototype.archiveRecentItem.call(this,t,o)},t.prototype.shouldLoadMore=function(e,t){return u.getRecentActivityCache().shouldLoadMore(e,t)},t.prototype.handlePathClick=function(e,t,o){P(e.currentTarget.href,h.ActionTypes.OPEN_PATH,t.attachmentIds,o,e)},t.prototype.shouldRenderItemActions=function(e){for(var t in e)if("share"!==t&&e[t])return!0;return!1},t.prototype.getShareButtonVisibility=function(e,t){return e.federatedRecentItem?e.federatedRecentItem.isShareable()?v.RecentElementVisibilities.SHOWN:v.RecentElementVisibilities.HIDDEN:t?v.RecentElementVisibilities.SHOWN:v.RecentElementVisibilities.HIDDEN},t.prototype.maybeInitLoggingAndGetTTILogger=function(){return function(){return null}},t.prototype.renderRecentActivityContainer=function(e,t,o){return e},t.prototype.renderItems=function(e){return n.createElement("ul",{className:"recents-view__sections"},n.createElement("li",{className:"recents-section"},n.createElement(d.RecentActivityListView,{items:e.items,isPending:e.isPending,renderingInfo:e.renderingInfo})))},t.prototype.renderItemActionsPlaceholder=function(){return n.createElement(R,{className:"recents-item__more-actions-placeholder",group:"web",name:"overflow-glyph",alt:"…"})},t.prototype.prefetchOnMount=function(e){this.loadPreFetchedPage(e)},t.prototype.renderMoreActionsElement=function(e){return A.renderMoreActionsButton(e)},t.prototype.previewAttachment=function(e,t,o){C(t.find(function(t){return t.id===e}),a.extractAttachmentIds(t),o)},t.prototype.possiblyRequireFileViewer=function(){},t})(T.RecentActivityVersionShared);t.RecentActivityVersion2=new D});
//# sourceMappingURL=pkg-home.min.js-vflEKSneY.map