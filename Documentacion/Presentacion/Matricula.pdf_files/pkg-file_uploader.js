(function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/actions",["modules/core/i18n","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/filepath","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper"],function(t,o,a,s,r,n){var i,l,u,d,p,c,m,f,assert,h;return f=t._,assert=o.assert,h=s.file_extension,m=r.UploaderStore,p=r.UploaderActionTypes,l=r.FileStatus,u=r.FileUpload,d=r.UploadErrorType,i=["pages","key","app","numbers","band","photolibrary","rcproject","rtfd","graffle","logic","logicx","lpdf","sketch","screenflow","scriv","dvdproj","mindnode","cmproj","xcodeproj","imovielibrary","mpkg","imovieproject","1password","agilekeychain","fcpbundle","abbu","mindnode","theater","gameproj","aplibrary","itlp","lrdata","ydevice","bundle","framework","plugin","kext","pkg"],c=(function(){function t(){}return t.prototype.initPLU=function(t,o){if(!n.isInitialized)return this.sendNS=!1,n.init(t,o),n.onFilesAdded((function(t){return function(o){var s,r,n,l,u,c,m,_,g,U;for(r=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],null==n.size&&a.push(n);return a})(),o=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],null!=n.size&&a.push(n);return a})(),l=0,c=r.length;l<c;l++)s=r[l],a.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:s,errorType:d.EMPTY_OR_FOLDER,errorMessage:f("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}});for(_=function(t){var o;return o=h(t.name),e.call(i,o)>=0&&t.size%34===0},U=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],_(n)&&a.push(n);return a})(),o=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],_(n)||a.push(n);return a})(),u=0,m=U.length;u<m;u++)g=U[u],a.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:g,errorType:d.PACKAGE_FILE,errorMessage:f("This file is a package file and can’t be uploaded directly. To upload a package file via the web, try zipping it first.")}});return r.length&&t.cancelUploads({files:r}),U.length&&t.cancelUploads({files:U}),a.dispatch({type:p.QUEUE_UPLOADS,data:{files:o}}),t._frobPLU()}})(this)),n.onUploadProgress(function(e){var t,o,s,r,i;if(!m.isUploadCancelled(e.uploadId))return r=e.percentUploaded,o=r*m.currentUpload().size/100,i=o+m.totalSizeOfCompletedUploads(),t=n.bytesPerSec(),s=m.fileList().count(function(e){var t;return(t=e.status)===l.PENDING||t===l.UPLOADING}),a.dispatch({type:p.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:r,numSecondsLeft:(m.totalSize()-i)/t+s}})}),n.onFileUploaded((function(e){return function(t,o){var s;if(!m.isUploadCancelled(t.uploadId))return s=JSON.parse(o.response),"error"in s?(n.removeFiles({files:[t]}),"ignored"===s.error?a.dispatch({type:p.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:d.IGNORED,errorMessage:f("This file was skipped because it’s an internal system file.")}}):a.dispatch({type:p.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:d.GENERIC}})):(assert("complete"===s.status),assert(s.total_size===t.size),assert(s.upload_id===t.uploadId),a.dispatch({type:p.COMPLETE_UPLOAD,data:{uploadId:t.uploadId}})),e._frobPLU()}})(this)),n.onError((function(e){return function(t,o,s){return m.fileList().has(t.uploadId)?a.dispatch({type:p.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:o,errorMessage:s}}):a.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:t,errorType:o,errorMessage:s}}),e._frobPLU()}})(this))},t.prototype.setPath=function(e){var t,o,s;if(o=e.path,t=null==(s=e.hasPermissionToUploadToFolder)||s,o!==m.path()||t!==m.hasPermissionToUploadToFolder())return a.dispatch({type:p.SET_PATH,data:{path:o,hasPermissionToUploadToFolder:t}})},t.prototype.setUser=function(e){var t;return t=e.user,a.dispatch({type:p.SET_USER,data:{user:t}})},t.prototype.setNumDraggingFiles=function(e){var t,o,s;return o=e.numDraggingFiles,t=null!=(s=e.isInternalTransfer)&&s,a.dispatch({type:p.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:o,isInternalTransfer:t}})},t.prototype.addFilesToPLU=function(e){var t,o,a;return t=e.files,o=null!=(a=e.path)?a:m.path(),n.addFiles({files:t,path:o}),this.setIsInlineStatusDismissed({isInlineStatusDismissed:!1})},t.prototype.addDirectoriesToPLU=function(t){var o,s,r,n,l,u,c,_,g,U,E,T;for(s=t.directoryEntries,o=m.path(),n=[],_=0,l=(function(e){return function(){var t;return(t=function(){var o,a,s;if(n.length>0)return s=n.pop(),a=s.entry,o=s.dest,a.file(function(a){return e.setPath({path:o}),e.addFilesToPLU({files:[a],path:o}),t()})})()}})(this),g=function(e){var t,a;return _+=1,a=e.createReader(),(t=function(){return a.readEntries(function(a){var s,r,i,u;if(a.length>0){for(r=0,i=a.length;r<i;r++)u=a[r],u.isDirectory?g(u):(s=o+e.fullPath,s=s.split("//").join("/"),n.push({entry:u,dest:s}));return t()}if(_-=1,0===_)return l()})})()},E=[],u=0,c=s.length;u<c;u++)T=s[u],U=h(T.name),e.call(i,U)>=0?(r=new File({name:T.name,dest:o}),E.push(a.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:r,errorType:d.PACKAGE_FILE,errorMessage:f('Due to browser limitations, OSX package files files cannot be uploaded using drag-and-drop. Please try using the "Upload…" dialog.')}}))):E.push(g(T));return E},t.prototype.setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,a.dispatch({type:p.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},t.prototype.setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,a.dispatch({type:p.SET_IS_INLINE_STATUS_DISMISSED,data:{isInlineStatusDismissed:t}})},t.prototype.setSendNS=function(e){return this.sendNS=e,n.setSendNS(e)},t.prototype.cancelUploads=function(e){var t;return t=e.files,n.removeFiles({files:t}),a.dispatch({type:p.CANCEL_UPLOADS,data:{files:t}}),this._frobPLU()},t.prototype.manuallySetInErrorState=function(e){var t,o,s;return s=e.file,o=e.errorType,t=e.errorMessage,n.removeFiles({files:[s]}),a.dispatch({type:p.UPLOAD_ERROR,data:{uploadId:s.uploadId,errorType:o,errorMessage:t}}),this._frobPLU()},t.prototype._startUpload=function(e){var t,o,s,r;return o=e.file,a.dispatch({type:p.START_UPLOAD,data:{file:o}}),r="url"===(s=h(o.name))||"webloc"===s||"website"===s?0:1,t={dest:o.dest,reported_total_size:o.size,uploadId:o.uploadId,_subject_uid:o.userId,offset:0,overwrite:r},this.sendNS&&(t.ns_id=o.ns_id,t.ns_path=o.ns_path),n.setAjaxParams(t),n.start(),!0},t.prototype._frobPLU=function(){var e;if(e=m.nextUpload(),null!=e&&null==m.currentUpload())return assert(e instanceof u),this._startUpload({file:e})},t})(),{UploaderDispatcher:a,UploaderActions:new c}})}).call(this),define("modules/clean/react/file_uploader/exp_subgrowth_pro_nearquota_upload_modal",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/image","modules/clean/react/modal","modules/clean/static_urls","modules/core/i18n","modules/clean/ajax","modules/clean/react_format"],function(e,t,o,a,s,r,n,i,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.componentDidMount=function(){var e=window.ensemble&&window.ensemble.viewer.getActiveUser().userId;u.SilentBackgroundRequest({url:"/log_nearquota_upload_modal_variant",data:{_subject_uid:e}})},t.prototype.renderAltAction=function(){return a.createElement("a",{href:"/pro/out-of-space?oqa=upl_nq"},l._("Learn More"))},t.prototype.render=function(){return a.createElement(n.Modal,{ref:"NearquotaUploadModal",style:"clean",onDismiss:this.props.onDismiss,onAccept:this.props.onAccept,altAction:this.renderAltAction(),acceptButtonText:l._("Continue adding files"),acceptButtonImportance:"primary",className:"NearquotaUploadModal",showX:!0},a.createElement(r,{src:i.static_url("/static/images/browse/illo_how-create-vflZtnnP8.png"),srcHiRes:i.static_url("/static/images/browse/illo_how-create@2x-vflkv0qQG.png"),className:"NearquotaUploadModal__image"}),a.createElement("h2",{className:"NearquotaUploadModal__title"},l._("Thanks for uploading!")),a.createElement("p",{className:"NearquotaUploadModal__copy"},l._("Just so you know, you’re getting close to your space limit.")),a.createElement("p",{className:"NearquotaUploadModal__copy"},l._("Learn more about what to do if you run out of space.")))},t})(a.Component),c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.componentDidMount=function(){u.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_nearquota_upload_modal",variant:"V1"}})},t.prototype.render=function(){return a.createElement("div",{className:"exp-subgrowth-pro-nearquota-upload-modal"},a.createElement("div",null,a.createElement(r,{className:"exp-subgrowth-pro-nearquota-upload-modal__warning",src:i.static_url("/static/images/browse/warning-vflZsXcW-.svg"),alt:l._("Warning")})),a.createElement("p",{className:"exp-subgrowth-pro-nearquota-upload-modal__copy"},d.reactFormat(l._("Thanks for adding stuff to Dropbox! Just so you know, you’re getting close\n          to your space limit. <overQuotaLink>Learn more</overQuotaLink> about what to do if you\n          run out of space."),{overQuotaLink:a.createElement("a",{key:"nq-link",href:"/pro/out-of-space?oqa=upl_nq"})})))},t})(a.Component);t.NearquotaUploadModal=s(p,["/static/css/exp_subgrowth_pro_nearquota_upload_modal-vflHorZB1.css"]),t.NearquotaUploadAltAction=s(c,["/static/css/exp_subgrowth_pro_nearquota_upload_modal-vflHorZB1.css"])}),function(){define("modules/clean/react/file_uploader/file_uploader_modal",["jquery","external/immutable","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/analytics","modules/clean/ajax","modules/clean/browse_interface","modules/clean/browse/browse_drag_utils","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/react/button","modules/clean/react/browse/actions","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/exp_subgrowth_pro_nearquota_upload_modal","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react_format","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/react_logger","modules/clean/static_urls","modules/clean/viewer","modules/constants/python","modules/constants/payments","modules/core/browser","modules/core/cookies","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,o,a,s,r,n,i,l,u,d,p,c,m,f,h,_,g,U,E,T,v,b,y,N,I,L,D,O,w,A,S,P,F,R,M,x,B,C,k,q){var Q,G,z,V,j,H,Y,W,$,Z,J,K,X,ee,te,oe,ae,se,re,ne,ie,le,ue,de;return n.TeamsWebActionsLogger,ne=l.get_browse_root_name,ae=l.browse_uri_for_fq_path,h.button,h.link_button,_.browseActions,oe=U.browseStore,K=E.UploaderActions,T.INTERNAL_FILE_DATA_TRANSFER_TYPE,Q=T.FileStatus,J=T.UploadErrorType,H=T.OVER_QUOTA_STATUS,v.NearquotaUploadModal,j=v.NearquotaUploadAltAction,X=b.UploaderStore,G=b.FileUpload,V=L.Modal,ie=D.reactFormat,$=w.Tooltip,Z=w.TooltipPosition,Y=A.ReactLogger,ue=S.static_url,W=F.TRADEMARK_BUSINESS,ee=C._,de=C.ungettext,g.BrowseLogEventSources,se=a.createElement,le=a.DOM,le.div,le.a,le.form,re=a.DOM,te=function(e){var t,o,a,s,r,n,i;return null==e&&(e={}),n=e.user,a=e.path,o=null!=(s=e.maxLength)?s:1e3,i=P.get_viewer(),i.is_paired&&n.is_team&&(r=i.team_name),"/"===a?i.is_paired?n.is_team?ee(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:r}):ee(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):ee(" upload to your Dropbox"):(t=c.em_snippet(m.filename(a),o),i.is_paired?n.is_team?ee(" upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:r}):ee(" upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):ee(" upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},z=a.createClass({displayName:"FileUploaderModal",mixins:[f(X)],DROPZONE_ID:"upload-modal-dropzone",propTypes:{dragAndDropEnabled:a.PropTypes.bool,shouldShowDestinationLink:a.PropTypes.bool,onModalDismissed:a.PropTypes.func,clickOutToClose:a.PropTypes.bool,sendNS:a.PropTypes.bool,isTeamOnboarding:a.PropTypes.bool,expSubgrowthProNearquotaUploadModal:a.PropTypes.string,userQuotaUsageRatio:a.PropTypes.number,tsdQuotaUsageRatio:a.PropTypes.number,numTeamMembers:a.PropTypes.number,numTeamAdmins:a.PropTypes.number,teamAdminEmail:a.PropTypes.string,teamAdminFname:a.PropTypes.string,promptAdminToUpgradeEmailTemplateUrl:a.PropTypes.object,removeBasicUploader:a.PropTypes.bool},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onModalDismissed:function(){},clickOutToClose:!0,sendNS:!1,isTeamOnboarding:!1,numTeamMembers:0,numTeamAdmins:0}},getInitialState:function(){return{usingBasicUploader:!1,basicUploaderFile:null,overQuotaStatus:H.NONE}},_get_state_from_stores:function(){return{path:X.path(),ns_id:oe.context().currentNSID,ns_path:oe.context().currentNSPath,user:X.user(),fileList:X.fileList(),numDraggingFiles:X.numDraggingFiles(),currentUpload:X.currentUpload(),numSecondsLeft:X.numSecondsLeft(),hasPermissionToUploadToFolder:X.hasPermissionToUploadToFolder()}},componentWillMount:function(){return Y.start(this.constructor.displayName)},componentDidMount:function(){var t;return this._setBrowseButton(),setTimeout((function(e){return function(){return e.forceUpdate()}})(this),250),e(window).on("resize.uploaderModal",(function(e){return function(){return e._setBrowseButton()}})(this)),Y.end(this.constructor.displayName),t=H.NONE,0===this.state.user.paid&&("personal"===this.state.user.role?this.props.userQuotaUsageRatio>1?t=H.BASIC_OVER_QUOTA:this.props.userQuotaUsageRatio>.9&&(t=H.BASIC_NEAR_QUOTA):this.state.user.is_team&&P.get_viewer().team_is_limited&&(this.state.user.is_cdm_member&&!this.state.path.startsWith(this.state.user.cdm_tmf_path)?this.props.tsdQuotaUsageRatio>1&&(t=H.LIMITED_TEAM_TSD_OVER_QUOTA):this.props.userQuotaUsageRatio>1&&(t=H.LIMITED_TEAM_USER_OVER_QUOTA))),this.setState({overQuotaStatus:t})},componentDidUpdate:function(t,o){var a,r,n,i;if(this._setBrowseButton(),this.state.numDraggingFiles?this.state.usingBasicUploader?k.error("You can‖t drag and drop upload right now."):(a=e(s.findDOMNode(this.refs.modal.refs.modalBox)).find("#"+this.DROPZONE_ID),a.length||e("#"+this.DROPZONE_ID).clone().prependTo(e(s.findDOMNode(this.refs.modal.refs.modalBox))).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1)):e(s.findDOMNode(this.refs.modal)).find("#"+this.DROPZONE_ID).remove(),this.state.fileList.count()>o.fileList.count()&&(n=e(s.findDOMNode(this.refs.uploadFilesList)),r=null!=(i=n.find(".upload-file"))?i.eq(o.fileList.count()):void 0,r.length))return n.scrollTop(n.scrollTop()+r.position().top)},componentWillUnmount:function(){return y.setBrowseButton(null),e(window).off("resize.uploaderModal")},FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_renderToggleButton:function(){var e,t;return this.state.usingBasicUploader?(t=ee("Switch to the advanced file uploader"),e="enhanced-uploader-link"):this.props.removeBasicUploader||(t=ee("Switch to the basic file uploader"),e="basic-uploader-link"),re.button({onClick:(function(e){return function(t){return e.setState({usingBasicUploader:!e.state.usingBasicUploader})}})(this),className:o("button-as-link","button-as-link--inline",e),"aria-label":t})},_setBrowseButton:function(){var t;return t=s.findDOMNode(this.refs.pluFileChooseButton),y.setBrowseButton(t),e(t).focus()},_handleClose:function(){var e,t;t=this.state.fileList.find(function(e){var t;return(t=e.status)===Q.PENDING||t===Q.UPLOADING}),t||K.setIsInlineStatusDismissed({isInlineStatusDismissed:!0}),K.setIsUploadModalOpen({isUploadModalOpen:!1}),V.close(),"function"==typeof(e=this.props).onModalDismissed&&e.onModalDismissed()},_handleCancel:function(e){return K.cancelUploads({files:[e]})},_handleBasicChooseButtonMouseClick:function(t){if(null!=this.refs.fileInput)return e(s.findDOMNode(this.refs.fileInput)).click()},_handleBasicFileInputChange:function(e){var t,o,a,r,n,i;return g.logUploadFile({uid:this.state.user.id,num_files:1,num_dirs:0,uploader_type:"basic",upload_method:"chooser"}),a=s.findDOMNode(this.refs.fileInput),o=null!=(r=a.files)&&"function"==typeof r.item?r.item(0):void 0,i=a.value,null!=o?(n={name:o.name,size:o.size,userId:this.state.user.id,percentUploaded:100,status:Q.UPLOADING},this.props.sendNS?(n.ns_id=this.state.ns_id,n.ns_path=this.state.ns_path+"/"+o.name):n.dest=this.state.path,this.setState({basicUploaderFile:new G(n)},(function(e){return function(){return s.findDOMNode(e.refs.basicUploadForm).submit()}})(this))):null!=i?(t="C:\\fakepath\\",0===i.indexOf(t)?this.setState({basicUploaderFile:new G({name:i.slice(t.length),size:null,dest:this.state.path,userId:this.state.user.id,percentUploaded:100,status:Q.UPLOADING})},(function(e){return function(){return s.findDOMNode(e.refs.basicUploadForm).submit()}})(this)):s.findDOMNode(this.refs.basicUploadForm).submit()):void 0},_limitedTeamOverquotaLink:function(e){var t;return this.state.user.is_cdm_member&&!this.state.user.is_team_admin&&this.props.numTeamAdmins>0?this.props.promptAdminToUpgradeEmailTemplateUrl:(t=1===this.props.numTeamMembers?"/plans":"/team/upgrade",q({path:t,query:{_tk:"over_quota",_camp:"upload_modal",oqa:e?"upl":"upl_b"}}))},_renderIntroModalButtons:function(){var e,t,o,a,s,r,n,i;return t=re.div({className:"u-font-medium"},this.state.overQuotaStatus===H.BASIC_OVER_QUOTA?ie(ee("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:re.a({className:"overquota-uploader-link",href:"/upgrade?oqa=upl"})}):!this.state.user.is_cdm_member||(s=this.state.overQuotaStatus)!==H.LIMITED_TEAM_USER_OVER_QUOTA&&s!==H.LIMITED_TEAM_TSD_OVER_QUOTA?this.state.overQuotaStatus===H.LIMITED_TEAM_USER_OVER_QUOTA?ie(ee("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:re.a({className:"overquota-uploader-link",href:this._limitedTeamOverquotaLink(!0)})}):null!=this.state.basicUploaderFile?ee("This may take a while depending on the size of the file."):this.state.usingBasicUploader?ie(ee("Uploading multiple files? Try our <enhancedUploaderLink>enhanced uploader</enhancedUploaderLink>."),{enhancedUploaderLink:this._renderToggleButton()}):this.props.removeBasicUploader?ee("Having problems? Please try again."):ie(ee("Having problems? Try the <basicUploaderLink>basic uploader</basicUploaderLink>."),{basicUploaderLink:this._renderToggleButton()}):""),a=null,n=null,i=ee(this.state.user.is_cdm_member?this.state.user.is_team_admin||0===this.props.numTeamAdmins?"Get more space":"Ask for more space":"Upgrade to Upload"),this.state.overQuotaStatus===H.BASIC_OVER_QUOTA?(o=R.BUY_URL+"?oqa=upl_b",a=re.a({className:"dbmodal-button c-btn c-btn--primary",href:o},i)):(r=this.state.overQuotaStatus)===H.LIMITED_TEAM_USER_OVER_QUOTA||r===H.LIMITED_TEAM_TSD_OVER_QUOTA?a=re.a({className:"dbmodal-button c-btn c-btn--primary",href:this._limitedTeamOverquotaLink(!1)},i):this.state.usingBasicUploader?null==this.state.basicUploaderFile&&(a=re.button({className:"dbmodal-button c-btn c-btn--primary",onClick:this._handleBasicChooseButtonMouseClick},ee("Choose a file"))):a=re.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--primary"},ee("Choose files")),null==this.state.basicUploaderFile&&(n=re.button({importance:"tertiary",className:"dbmodal-button c-btn c-btn--secondary u-mar-left-s",onClick:this._handleClose},ee("Cancel"))),this.state.overQuotaStatus===H.BASIC_OVER_QUOTA||this.state.overQuotaStatus===H.LIMITED_TEAM_USER_OVER_QUOTA&&!this.state.user.is_cdm_member?(e="c-banner c-banner--warning upload-overquota-banner__content",re.div({className:"u-mar-vertical-l clearfix"},re.div({className:"u-l-fr"},a,n),re.div({className:"upload-overquota-banner__container"},re.div({id:"upload-overquota-banner",className:e},t)))):re.div({className:"u-mar-top-l"},se(N.Flag,{spacing:"s",rightAttachment:re.div({},a,n)},t))},_renderFileListModalButtons:function(){var e,t,o,a;return o=this.state.fileList.find(function(e){var t;return(t=e.status)===Q.PENDING||t===Q.UPLOADING}),t=o?"tertiary":"primary",a=re.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary"},ee("Add more files")),e=re.button({className:"dbmodal-button c-btn c-btn--"+t,onClick:this._handleClose},ee(o?"Hide":"Done")),re.div({className:"u-mar-top-s"},se(N.Flag,{leftAttachment:a,rightAttachment:e,spacing:"s"},re.div({className:"u-font-small"},o?void 0:this.props.removeBasicUploader?ee("Having problems? Please try again."):ie(ee("Having problems? Try the <basicUploaderLink>basic uploader</basicUploaderLink>."),{basicUploaderLink:this._renderToggleButton()}))))},_renderIntroMessage:function(){var e,t,o,a,s;return s=te({user:this.state.user,path:this.state.path}),a=P.get_viewer().team_name,re.span({},!this.state.user.is_cdm_member||(t=this.state.overQuotaStatus)!==H.LIMITED_TEAM_USER_OVER_QUOTA&&t!==H.LIMITED_TEAM_TSD_OVER_QUOTA?(o=this.state.overQuotaStatus)===H.BASIC_OVER_QUOTA||o===H.LIMITED_TEAM_USER_OVER_QUOTA?ee("You can’t upload files because you’re out of space. Before you can upload to Dropbox, you need to get more space."):this.state.usingBasicUploader?ee("Choose a file to %(upload_folder_name)s. The basic uploader can only upload one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:s}):this.props.isTeamOnboarding?ee("Choose files to add to the %(team_name)s team folder. You can also drag and drop files onto this page to upload them. Anyone who joins the %(team_name)s Dropbox will have access to files in the team folder.").format({team_name:a}):this.props.dragAndDropEnabled?ee("Choose files to %(upload_folder_name)s. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:s}):ee("Choose files to %(upload_folder_name)s. You can select more than one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:s}):(e=this.state.overQuotaStatus===H.LIMITED_TEAM_USER_OVER_QUOTA?ee("Your member folder is full, so no new files can be added"):ee("The %(team_name)s shared workspace is full, so no new files can be added").format({team_name:a}),this.state.user.is_team_admin||!this.props.numTeamAdmins?ie(de("%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade your account </upgradeLink>.","%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade to %(trademark_business)s</upgradeLink>.",this.props.numTeamMembers),{dropbox_full_message:e,trademark_business:W,upgradeLink:re.a({href:this._limitedTeamOverquotaLink(!1)})}):de("%(dropbox_full_message)s. To get more space, ask your Dropbox admin (%(admin_email)s).","%(dropbox_full_message)s. To get more space, ask your Dropbox admins (%(admin_email)s and %(num_other_admins)s others).",this.props.numTeamAdmins).format({dropbox_full_message:e,admin_email:this.props.teamAdminEmail,num_other_admins:this.props.numTeamAdmins-1})))},_renderDropzone:function(){return re.div({ref:"dropzone",id:this.DROPZONE_ID,style:{display:"none"}},re.div({},de("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",this.state.numDraggingFiles,{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:te({user:this.state.user,path:this.state.path,maxLength:20})})))},_renderFileListRowStatus:function(e){var t;return re.div({className:"status-col"},e.status===Q.UPLOADING&&100===e.percentUploaded?se(I,{src:ue("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:ue("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):(t=e.status)===Q.PENDING||t===Q.UPLOADING?re.button({className:"button-as-link",onClick:(function(t){return function(o){return o.preventDefault(),t._handleCancel(e)}})(this)},se(O,{group:"web",name:"xclose",alt:ee("Cancel")})):e.status===Q.COMPLETE?se(O,{group:"web",name:"s_check",alt:ee("Upload successful")}):e.status===Q.CANCELLED?se(I,{src:ue("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:ue("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:ee("Upload cancelled")}):e.status===Q.FAILED?se(I,{src:ue("/static/images/nosync-vfl18cuTS.png"),srcHiRes:ue("/static/images/nosync@2x-vflgS4F07.png"),alt:ee("Error")}):void 0)},_renderFileListRowError:function(e){var t,o;return t=(null!=(o=e.errorMessage)?o.length:void 0)>0?e.errorMessage:ee(this.props.removeBasicUploader?"Something went wrong while uploading this file.":"Something went wrong while uploading this file. If the problem persists, please try the basic uploader."),re.div({className:"error-col"},re.span({className:"error-msg"},ee(e.errorType===J.FILE_SIZE_ERROR?"File too large":"Upload Error")),re.span({className:"error-details"},se($,{position:Z.RIGHT,tooltip_contents:re.div({},t),tooltip_classname:"upload-error-tooltip"},se(O,{group:"web",name:"information",alt:ee("More information")}))))},_renderFileListRowDest:function(e){var t,o;return re.div({className:"dest-col"},e.status===Q.CANCELLED?ee("Canceled"):(o=P.get_viewer().get_user_by_id(e.userId),t=oe.context().isNonUserRelativeContext?"":ne(o),re.a({href:ae(o,e.dest).toString()},c.em_snippet(""+t+e.dest,this.DEST_SNIPPET_LENGTH,0))))},_renderFileListRow:function(e,t){var a,s;return a=e.status===Q.UPLOADING?e.percentUploaded:e.status===Q.PENDING?0:100,s={"upload-file":!0,complete:e.status===Q.COMPLETE,cancelled:e.status===Q.CANCELLED,error:e.status===Q.FAILED},re.li({className:o(s),key:e.uploadId},re.div({className:"upload-progress-bar",style:{width:a+"%"}}),re.div({className:"upload-file-info",style:{overflow:"hidden"}},re.div({className:"filename-col"},se(O,{group:"web",name:m.file_icon(e.name),alt:""}),re.span({className:"filename"},c.em_snippet(e.name,this.FILENAME_SNIPPET_LENGTH)),null!=e.size?re.span({className:"size"}," - ",p.format_bytes(e.size)):void 0),e.status!==Q.FAILED?t?this._renderFileListRowDest(e):void 0:this._renderFileListRowError(e),this._renderFileListRowStatus(e)))},_renderFileList:function(e,t){var o,a,s;return s=null==(a=(null!=t?t:{}).shouldShowDestinationLink)||a,re.ol({ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},function(){var t,a,r;for(r=[],t=0,a=e.length;t<a;t++)o=e[t],r.push(this._renderFileListRow(o,s));return r}.call(this))},_renderTimeLeft:function(){var e;if(e=this.state.currentUpload,null!=e&&e.status===Q.UPLOADING)return re.div({style:{marginTop:8,textAlign:"right"}},ee("%(time_left)s left").format({time_left:d.format_time(this.state.numSecondsLeft)}))},_renderBasicUploaderForm:function(){return re.form({id:"basic-upload-form",ref:"basicUploadForm",encType:"multipart/form-data",noValidate:"novalidate",method:"post",action:"https://dl-web.dropbox.com/upload"},re.input({type:"hidden",name:"t",value:x.read("__Host-js_csrf")}),re.input({type:"hidden",name:"_subject_uid",value:this.state.user.id}),re.input({type:"hidden",name:"plain",value:"yes"}),re.input({type:"hidden",name:"dest",value:this.state.path}),this.props.sendNS?[re.input({type:"hidden",name:"ns_id",value:this.state.ns_id}),re.input({type:"hidden",name:"ns_path",value:this.state.ns_path})]:void 0,re.input({type:"file",name:"file","aria-label":ee("Upload files"),tabIndex:"-1",style:{display:"none"},ref:"fileInput",onChange:this._handleBasicFileInputChange}))},render:function(){var e,t,o,a,s;return s=ee(this.props.isTeamOnboarding?"Which files would you like to add?":!this.state.user.is_cdm_member||(o=this.state.overQuotaStatus)!==H.LIMITED_TEAM_USER_OVER_QUOTA&&o!==H.LIMITED_TEAM_TSD_OVER_QUOTA?"Upload to Dropbox":"More space needed"),e=null,"V1"===this.props.expSubgrowthProNearquotaUploadModal&&(t=null!=this.state.fileList.find(function(e){return e.status===Q.COMPLETE}),t&&this.state.overQuotaStatus===H.BASIC_NEAR_QUOTA&&(e=se(j,{}))),re.div({ref:"container"},this._renderDropzone(),!this.props.removeBasicUploader||0!==this.state.fileList.count()||(a=this.state.overQuotaStatus)!==H.NONE&&a!==H.BASIC_NEAR_QUOTA?se(V,{ref:"modal",title:s,showX:!1,clickOutToClose:this.props.clickOutToClose,altAction:e,buttonComponent:0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:(function(e){return function(t){return null!=e.state.basicUploaderFile?void t.preventDefault():K.setIsUploadModalOpen({isUploadModalOpen:!1})}})(this)},this.state.usingBasicUploader?this._renderBasicUploaderForm():void 0,null!=this.state.basicUploaderFile?this._renderFileList([this.state.basicUploaderFile],{shouldShowDestinationLink:!1}):0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroMessage():this._renderFileList(this.state.fileList.toArray(),{shouldShowDestinationLink:this.props.shouldShowDestinationLink}),this._renderTimeLeft()):void 0)}}),{FileUploaderModal:z}})}.call(this),function(){define("modules/clean/react/file_uploader/inline_upload_status",["external/immutable","external/classnames","external/react","external/react-dom","modules/clean/datetime","modules/clean/em_string","modules/clean/react/button","modules/clean/react/browse/action_logger","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/store","modules/clean/react/image","modules/clean/react/sprite","modules/clean/static_urls","modules/core/i18n"],function(e,t,o,a,s,r,n,i,l,u,d,p,c,m,f){var h,_,g,U,E,T,v,b,y,N,I;return n.button,n.link_button,E=l.UploaderActions,h=u.FileStatus,U=u.UploadErrorType,_=d.FileUpload,N=m.static_url,T=f._,I=f.ungettext,i.BrowseLogEventSources,v=o.createElement,y=o.DOM,y.div,y.a,y.form,b=o.DOM,g=o.createClass({displayName:"InlineUploadStatus",propTypes:{fileList:o.PropTypes.instanceOf(e.OrderedMap).isRequired,currentUpload:o.PropTypes.instanceOf(_),numSecondsLeft:o.PropTypes.number,onViewDetails:o.PropTypes.func},FILENAME_SNIPPET_LENGTH:30,_getOverallUploadState:function(){return this.props.fileList.find(function(e){var t;return(t=e.status)===h.PENDING||t===h.UPLOADING})?"uploading":this.props.fileList.find(function(e){return e.status===h.FAILED})?"error":"complete"},_getProgressBarWidth:function(){var e;return e=this._getOverallUploadState(),"uploading"===e&&null!=this.props.currentUpload?this.props.currentUpload.percentUploaded:"complete"===e||"error"===e?100:0},_getNumPendingFiles:function(){return this.props.fileList.count(function(e){return e.status===h.PENDING})},_getNumCompletedFiles:function(){return this.props.fileList.count(function(e){return e.status===h.COMPLETE})},_getNumNoncancelledFiles:function(){return this.props.fileList.count(function(e){return e.status!==h.CANCELLED})},_getNumErrors:function(){return this.props.fileList.count(function(e){return e.status===h.FAILED})},_renderIcon:function(){var e;return e=this._getOverallUploadState(),"uploading"===e?v(c,{group:"web",name:"s_sync",alt:T("Uploading")}):"complete"===e?v(c,{group:"web",name:"s_check",alt:T("Upload successful")}):v(p,{src:N("/static/images/nosync-vfl18cuTS.png"),
srcHiRes:N("/static/images/nosync@2x-vflgS4F07.png"),alt:T("Error")})},_renderCloseButton:function(){return b.button({className:"button-as-link",onClick:function(e){return e.preventDefault(),E.setIsInlineStatusDismissed({isInlineStatusDismissed:!0})}},v(c,{group:"web",name:"xclose",alt:T("Close")}))},_renderViewDetailsLink:function(){var e;return e=this._getNumPendingFiles(),b.span({className:"details"}," - ",b.button({className:"view-details button-as-link",onClick:(function(e){return function(t){var o;return t.preventDefault(),"function"==typeof(o=e.props).onViewDetails?o.onViewDetails():void 0}})(this)},e>0?I("%(num_pending_files)d file left","%(num_pending_files)d files left",e).format({num_pending_files:e}):T("View details")))},_renderFileDescription:function(){var e,t,o,a;return a=this._getOverallUploadState(),o=this._getNumNoncancelledFiles(),t=this._getNumErrors(),b.span({className:"file-desc"},null!=this.props.currentUpload?T("Uploading %(filename)s").format({filename:r.em_snippet(this.props.currentUpload.name,this.FILENAME_SNIPPET_LENGTH)}):"uploading"===a?T("Starting upload..."):"complete"===a?o>1?T("Uploaded %(num_files)d files").format({num_files:o}):T("Uploaded %(filename)s").format({filename:r.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):"error"===a?o>1?[T("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:this._getNumCompletedFiles(),num_files:o})," ",b.span({className:"num-errors"},I("- %(num_errors)d error","- %(num_errors)d errors",t).format({num_errors:t}))]:(e=this.props.fileList.last().errorType,e===U.GENERIC?T("Unable to upload %(filename)s").format({filename:r.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):T("Unable to upload %(filename)s: %(reason)s").format({filename:r.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH),reason:(function(){switch(e){case U.OVER_QUOTA_ERROR:return T("over quota");case U.FILE_SIZE_ERROR:return T("file too large");case U.CONNECTION_ERROR:return T("lost connection");case U.HTTP_ERROR:return T("server error");case U.EMPTY_OR_FOLDER:return T("can’t upload folders or empty files");case U.PACKAGE_FILE:return T("OSX package file")}})()})):void 0)},render:function(){var e,o;return e=this._getOverallUploadState(),o={"upload-file":!0,error:"error"===e,complete:"complete"===e},b.div({id:"inline-upload-status",className:t(o)},b.div({className:"inline-upload-info"},b.div({className:"icon"},this._renderIcon()),b.div({className:"files-info"},this._renderFileDescription(),b.span({className:"num-errors"}),this._renderViewDetailsLink()),b.div({className:"status"},"uploading"===e&&null!=this.props.numSecondsLeft?T("%(time_left)s left").format({time_left:s.format_time(this.props.numSecondsLeft)}):this._renderCloseButton())),b.div({className:"inline-upload-bar"},b.div({className:"inline-upload-progress",style:{width:this._getProgressBarWidth()+"%"}})))}}),{InlineUploadStatus:g}})}.call(this),define("modules/clean/react/file_uploader/mapper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(){this.fileIdMap={}}return e.prototype.pathOf=function(e){var t=this.fileIdMap[e];return t?t[1]:null},e.prototype.uploadIdOf=function(e){var t=this.fileIdMap[e];return t?t[0]:null},e.prototype.set=function(e,t,o){this.fileIdMap[e]=[t,o]},e})();t.uploaderMapper=new o}),define("modules/clean/react/file_uploader/oq_drag_drop_modal",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/react/modal","modules/clean/react_format","modules/clean/static_urls","modules/clean/react_logger","modules/constants/payments"],function(e,t,o,a,s,r,n,i,l,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){return e.call(this,"OQDragDropModalComponent",t)||this}return o.__extends(t,e),t.prototype.render=function(){return a.createElement("div",{className:"drag-drop-oq"},a.createElement(i.Modal,{style:"clean",className:"drag-drop-oq--modal",buttonComponent:this.renderButtons(),width:480},a.createElement("div",null,a.createElement(r,{src:u.static_url("/static/images/pro/overquota/overquota-folder-vflgFxxXj.png"),srcHiRes:u.static_url("/static/images/pro/overquota/overquota-folder@2x-vfloUmya6.png")})),a.createElement("div",{className:"drag-drop-oq--header"},n._("Your Dropbox is full")),a.createElement("div",{className:"drag-drop-oq--copy"},l.reactFormat(n._("In order to finish uploading %(filename)s, you need to add more storage to your Dropbox."),{filename:this.props.oqFilename}))))},t.prototype.renderButtons=function(){var e=p.OUT_OF_SPACE_URL+"?oqa=upl_dd";return a.createElement("div",{className:"drag-drop-oq--buttons"},a.createElement("a",{href:e,className:"drag-drop-oq--button c-btn c-btn--primary"},n._("Get more space")))},t})(d.ReactLogger);t.OQDragDropModal=s(c,["/static/css/browse/oq_drag_drop_upsell-vfliUOCI_.css"])}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_uploader/plu_wrapper",["jquery","modules/core/exception","external/plupload_dev","external/react","external/underscore","modules/clean/static_urls","modules/core/cookies","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/mapper","modules/clean/react/file_uploader/store","modules/clean/sharing/ui_util","modules/core/i18n"],function(t,o,a,s,r,n,i,l,u,d,p,c,m){var f,h,_,g,U,E,T,assert,v,b,y,N;return assert=o.assert,n.static_url,v=u.browseStore,N=d.uploaderMapper,U=p.UploaderStore,f=p.FileUpload,g=p.UploadErrorType,b=p.generateUploadId,h=c.GoldenGate,E=m._,y=window.plupload,T=function(e,t){var o,a;return null==t&&(t={}),o=r.extend({},t,e),new f({uploadId:o.uploadId,dest:o.dest,ns_id:o.ns_id,ns_path:o.ns_path,name:o.name,size:o.size,userId:o.userId,percentUploaded:null!=(a=o.percent)?a:0})},_=(function(){function o(){this.removeFiles=e(this.removeFiles,this),this.bytesPerSec=e(this.bytesPerSec,this),this.onError=e(this.onError,this),this.onFileUploaded=e(this.onFileUploaded,this),this.onUploadProgress=e(this.onUploadProgress,this),this.onFilesAdded=e(this.onFilesAdded,this),this.setBrowseButton=e(this.setBrowseButton,this),this.setAjaxParams=e(this.setAjaxParams,this),this.start=e(this.start,this),this.addFiles=e(this.addFiles,this),this.init=e(this.init,this),this.isInitialized=!1,this.sendNS=!1,this.removeBasicUploader=!1,this.uploaderFixGating=!1}return o.prototype.PLU_CONTAINER_ID="flash-upload-container",o.prototype.setSendNS=function(e){return this.sendNS=e},o.prototype.init=function(e,o){var a;if(!this.isInitialized)return this.isInitialized=!0,this.removeBasicUploader=e,this.uploaderFixGating=o,this.$secretBrowseButton=t("<button>").addClass("secret-file-uploader-button").hide().appendTo(t("body")),this.$pluContainer=t("<div>").attr("id",this.PLU_CONTAINER_ID).css({position:"absolute",left:-2e3}).appendTo(t("body")),this.$currentExternalBrowseButton=t(),a={url:"https://dl-web.dropbox.com/chunked_upload",file_data_name:"file",runtimes:"html5",multipart_params:{},multipart:!1,max_retries:2,browse_button:this.$secretBrowseButton[0],max_file_size:"50000mb",chunk_size:"8mb",container:this.PLU_CONTAINER_ID,init:{ChunkUploaded:(function(e){return function(t,o,a){var s,r,n;return n=N.uploadIdOf(o.id),assert(JSON.parse(a.response).upload_id===n),r=U.fileList().get(n),s={dest:r.dest,reported_total_size:r.size,uploadId:r.uploadId,_subject_uid:r.userId,offset:a.offset,overwrite:1},e.sendNS&&(s.ns_id=r.ns_id,s.ns_path=r.ns_path),e.setAjaxParams(s)}})(this)}},this.uploader=new y.Uploader(a),this.uploader.init()},o.prototype.addFiles=function(e){var t,o;return t=e.files,o=e.path,this.isInitialized||this.init(),this.uploader.addFile(t,o)},o.prototype.start=function(){return this.isInitialized||this.init(),this.uploader.start()},o.prototype.setAjaxParams=function(e){var t,o,a,s,r,n,l,u;if(l=e.reported_total_size,o=e.dest,u=e.uploadId,r=e.offset,t=e._subject_uid,n=e.overwrite,a=e.ns_id,s=e.ns_path,this.isInitialized||this.init(),null==l||null==o||null==u||null==r||null==t||null==n)throw new Error("A required parameter to setAjaxParams was not given.");return this.uploader.settings.multipart_params={t:i.read("__Host-js_csrf"),reported_total_size:l,dest:o,upload_id:u,offset:r,_subject_uid:t,overwrite:n,ns_id:a,ns_path:s}},o.prototype.setBrowseButton=function(e){var o;return this.isInitialized||this.init(),"flash"===this.uploader.runtime?(this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.length?(t("#"+this.PLU_CONTAINER_ID).show().css({"z-index":1e3,position:"absolute",top:this.$currentExternalBrowseButton.offset().top,left:this.$currentExternalBrowseButton.offset().left,width:this.$currentExternalBrowseButton.outerWidth(),height:this.$currentExternalBrowseButton.outerHeight()}),o=t("#"+this.PLU_CONTAINER_ID+" > .moxie-shim"),o[0].style.top="0px",o[0].style.left="0px",o[0].style.width="100%",o[0].style.height="100%"):t("#"+this.PLU_CONTAINER_ID).hide()):(this.$currentExternalBrowseButton.off("click.PLUBrowseButton"),this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.on("click.PLUBrowseButton",(function(e){return function(){return e.$secretBrowseButton.click()}})(this)))},o.prototype.onFilesAdded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FilesAdded",(function(t){return function(o,a){var s;return l.logUploadFile({uid:U.user().id,num_files:a.length,uploader_type:"enhanced",upload_method:"chooser"}),s=a.map(function(e){var o,a,s,r,n;return n=b(),r=U.path(),t.uploaderFixGating&&(""!==e.dest?r=e.dest:e.dest=U.path()),t.uploaderFixGating||(e.dest=r),N.set(e.id,n,r),a=null,s=null,t.sendNS&&(o=t.getNsIdAndPath(r,e.name),a=o[0],s=o[1]),T(e,{uploadId:n,dest:r,userId:U.user().id,ns_id:a,ns_path:s})}),e(s)}})(this))},o.prototype.getNsIdAndPath=function(e,t){var o,a,s,r,n,i,l;return r=v.context().currentNSID,s=v.context().currentMountPoint,h.hasContentManagerCdm(U.user().id)?a=e:(i=e.split("/"),l="/"+i.slice(2).join("/"),a=l),o=a.replace(s,""),"/"===o&&(o=""),n=o+"/"+t,[r,n]},o.prototype.onUploadProgress=function(e){return this.isInitialized||this.init(),this.uploader.bind("UploadProgress",(function(t){return function(t,o){var a,s;return s=N.uploadIdOf(o.id),a=U.fileList().get(s),e(a.set("percentUploaded",o.percent))}})(this))},o.prototype.onFileUploaded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FileUploaded",(function(t){return function(t,o,a){var s,r;return r=N.uploadIdOf(o.id),s=U.fileList().get(r),e(s,a)}})(this))},o.prototype.onError=function(e){return this.isInitialized||this.init(),this.uploader.bind("Error",(function(t){return function(o,a){var s,r,n,i,l,u,d;if(null==a.file)throw new Error("PLU error without an associated file.");return r=(function(){switch(a.code){case y.FILE_SIZE_ERROR:return g.FILE_SIZE_ERROR;case y.HTTP_ERROR:return 0===a.status?g.CONNECTION_ERROR:507===a.status?g.OVER_QUOTA_ERROR:g.HTTP_ERROR;default:return g.GENERIC}})(),s=function(){switch(r){case g.OVER_QUOTA_ERROR:return E("This file can’t be uploaded because you are over your storage quota. If you believe this message to be in error, try refreshing the page.");case g.FILE_SIZE_ERROR:return E("This file is too large to upload using the Dropbox website. Please use the desktop client.");case g.HTTP_ERROR:return E(this.removeBasicUploader?"Something went wrong while uploading this file. There was a server error during the upload request.":"Something went wrong while uploading this file. There was a server error during the upload request. If the problem persists, please try the basic uploader.");case g.CONNECTION_ERROR:return E("Something went wrong while uploading this file. Check your connection to the internet and try again.");default:return E(this.removeBasicUploader?"Something went wrong while uploading this file.":"Something went wrong while uploading this file. If the problem persists, please try the basic uploader.")}}.call(t),d=N.uploadIdOf(a.file.id),U.fileList().has(d)?n=U.fileList().get(d):(l=null,u=null,t.sendNS&&(i=t.getNsIdAndPath(U.path(),a.file.name),l=i[0],u=i[1]),n=T(a.file,{uploadId:b(),dest:U.path(),ns_id:l,ns_path:u})),e(n,r,s)}})(this))},o.prototype.bytesPerSec=function(){var e;return this.isInitialized||this.init(),null!=(e=this.uploader.total)?e.bytesPerSec:void 0},o.prototype.removeFiles=function(e){var t,o,a,s,n;for(o=e.files,this.isInitialized||this.init(),a=0,s=o.length;a<s;a++)t=o[a],n=r.find(this.uploader.files,(function(e){return function(e){return N.uploadIdOf(e.id)===t.uploadId}})(this)),this.uploader.removeFile(n);return this.uploader.stop(),this.uploader.start()},o})(),new _})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/uploader",["jquery","external/react","external/react-dom","external/underscore","modules/clean/analytics","modules/clean/ajax","modules/clean/browse/browse_drag_utils","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/react/browse/actions","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/oq_drag_drop_modal","modules/clean/react/file_uploader/exp_subgrowth_pro_nearquota_upload_modal","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/modal","modules/clean/react_logger","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/react/file_uploader/file_uploader_modal","modules/clean/react/file_uploader/inline_upload_status"],function(t,o,a,s,r,n,i,l,u,d,p,c,m,f,h,_,g,U,E,T,v,b,y,N,I,L,D,O){var w,A,S,P,F,R,M,x,B,C,k,q,Q,G,z,V,j,H,Y,W,$,Z,J;return q=r.TeamsWebActionsLogger,H=p.browseActions,Y=m.browseStore,G=f.UploaderActions,F=h.INTERNAL_FILE_DATA_TRANSFER_TYPE,A=h.FileStatus,Q=h.UploadErrorType,C=h.OVER_QUOTA_STATUS,B=_.OQDragDropModal,x=g.NearquotaUploadModal,g.NearquotaUploadAltAction,z=U.UploaderStore,U.FileUpload,M=T.Modal,k=v.ReactLogger,V=N._,P=D.FileUploaderModal,R=O.InlineUploadStatus,w=c.BrowseLogEventSources,W=o.createElement,J=o.DOM,J.div,J.a,J.form,$=o.DOM,j=function(e){var t,o,a,s,r,n,i;return null==e&&(e={}),n=e.user,a=e.path,o=null!=(s=e.maxLength)?s:1e3,i=b.get_viewer(),i.is_paired&&n.is_team&&(r=i.team_name),"/"===a?i.is_paired?n.is_team?V(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:r}):V(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):V(" upload to your Dropbox"):(t=l.em_snippet(u.filename(a),o),i.is_paired?n.is_team?V(" upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:r}):V(" upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):V(" upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},Z=null,S=o.createClass({displayName:"FileUploader",mixins:[d(z)],propTypes:{dragAndDropEnabled:o.PropTypes.bool,shouldShowDestinationLink:o.PropTypes.bool,onFileUploadComplete:o.PropTypes.func,onAllFileUploadsComplete:o.PropTypes.func,onModalDismissed:o.PropTypes.func,clickOutToClose:o.PropTypes.bool,sendNS:o.PropTypes.bool,removeBasicUploader:o.PropTypes.bool,uploaderFixGating:o.PropTypes.bool,expSubgrowthProNearquotaUploadModal:o.PropTypes.string},statics:{showModal:function(){return Z?Z.showModal():void console.warn("Tried to show the file upload modal, but no FileUploader component has been instantiated on the page yet.")},showOOQModal:function(){return Z?Z.showOOQModal():void console.warn("Tried to show the out of quota modal, but no FileUploader component has been instantiated on the page yet.")},showModalWithTeamOnboarding:function(){if(Z)return Z.setState({isTeamOnboarding:!0},Z.showModal)},setBrowseButton:function(e){if(Z)return Z.setBrowseButton(e)}},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onFileUploadComplete:function(){},onAllFileUploadsComplete:function(){},onModalDismissed:function(){},clickOutToClose:!0,sendNS:!1,removeBasicUploader:!1,uploaderFixGating:!1}},getInitialState:function(){return{isTeamOnboarding:!1,hasOverquotaError:!1,userQuotaUsageRatio:0,tsdQuotaUsageRatio:0,numTeamMembers:0,numTeamAdmins:0,teamAdminEmail:"",teamAdminFname:"",promptAdminToUpgradeEmailTemplateUrl:"",seenNearquotaModal:!1,overQuotaStatus:C.NONE}},_get_state_from_stores:function(){return{path:z.path(),ns_id:Y.context().currentNSID,ns_path:Y.context().currentNSPath,user:z.user(),fileList:z.fileList(),numDraggingFiles:z.numDraggingFiles(),isInternalTransfer:z.isInternalTransfer(),currentUpload:z.currentUpload(),isUploadModalOpen:z.isUploadModalOpen(),numSecondsLeft:z.numSecondsLeft(),isInlineStatusDismissed:z.isInlineStatusDismissed(),hasPermissionToUploadToFolder:z.hasPermissionToUploadToFolder()}},INLINE_STATUS_CONTAINER_CLASS:"inline-upload-status-container",showModal:function(){var e;if(this.props.removeBasicUploader&&this.fetchQuotaUpsellInfo(),!this.props.removeBasicUploader||0!==this.state.fileList.count()||(e=this.state.overQuotaStatus)!==C.NONE&&e!==C.BASIC_NEAR_QUOTA)return M.showInstance(W(P,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,clickOutToClose:this.props.clickOutToClose,isTeamOnboarding:this.state.isTeamOnboarding,sendNS:this.props.sendNS,expSubgrowthProNearquotaUploadModal:this.props.expSubgrowthProNearquotaUploadModal,userQuotaUsageRatio:this.state.userQuotaUsageRatio,tsdQuotaUsageRatio:this.state.tsdQuotaUsageRatio,numTeamMembers:this.state.numTeamMembers,numTeamAdmins:this.state.numTeamAdmins,teamAdminEmail:this.state.teamAdminEmail,teamAdminFname:this.state.teamAdminFname,promptAdminToUpgradeEmailTemplateUrl:this.state.promptAdminToUpgradeEmailTemplateUrl,removeBasicUploader:this.props.removeBasicUploader})),G.setIsUploadModalOpen({isUploadModalOpen:!0})},_showNearquotaModal:function(){return M.showInstance(W(x,{onDismiss:this._dismissNearquotaModal,onAccept:this._acceptNearquotaModal})),this.setState({seenNearquotaModal:!0})},_acceptNearquotaModal:function(e){return e.preventDefault(),this.showModal()},_dismissNearquotaModal:function(e){return G.setIsUploadModalOpen({isUploadModalOpen:!1})},showOOQModal:function(){var e,t,o;return e=this.state.fileList.toArray().filter(function(e){return e.errorType===Q.OVER_QUOTA_ERROR||e.errorType===Q.GENERIC}),t=(null!=e&&null!=(o=e[e.length-1])?o.name:void 0)||V("this file"),M.showInstance(W(B,{oqFilename:t}))},componentWillMount:function(){if(k.start(this.constructor.displayName),Z)throw new Error("Only one FileUploader component may be rendered to the page at any time. You have tried to instantiate multiple uploaders.");return Z=this},componentDidMount:function(){var o;return G.initPLU(this.props.removeBasicUploader,this.props.uploaderFixGating),G.setSendNS(this.props.sendNS),this.dragEnterCount=0,this.lastEnteredElement=null,o=t(document),o.on("dragover.fileUploader",function(e){return e.preventDefault(),e.stopPropagation()}).on("dragenter.fileUploader",(function(t){return function(o){var a,r,n,i;if(o.preventDefault(),o.stopPropagation(),o.target!==t.lastEnteredElement)return t.lastEnteredElement=o.target,t.dragEnterCount+=1,n=(function(){var e;try{return null!=(e=o.originalEvent.dataTransfer.mozItemCount)?e:Object.keys(o.originalEvent.dataTransfer.items).length}catch(e){return 1}})(),i=o.originalEvent.dataTransfer.types,a=["Files","application/x-moz-file",F,"text/x-moz-url","text/uri-list","Url"],null!=i&&(null!=i.indexOf&&s.intersection(i,a).length>0||i instanceof DOMStringList&&(i.contains("Files")||i.contains("text/x-moz-url")||i.contains(F)||y.msie&&(i.contains("Text")||i.contains("text/plain"))))?(r=e.call(i,F)>=0||e.call(i,"text/plain")>=0||i instanceof DOMStringList&&(i.contains("Text")||i.contains("text/plain")),G.setNumDraggingFiles({numDraggingFiles:n,isInternalTransfer:r})):void 0}})(this)).on("dragleave.fileUploader",(function(e){return function(t){if(t.preventDefault(),t.stopPropagation(),e.lastEnteredElement=null,e.dragEnterCount-=1,e.dragEnterCount<1)return e.dragEnterCount=0,G.setNumDraggingFiles({numDraggingFiles:0})}})(this)).on("drop.fileUploader",this._handleFileDrop),t("<div>").addClass(this.INLINE_STATUS_CONTAINER_CLASS).prependTo(t("#page-content")),t(window).on("beforeunload.fileUploader",(function(e){return function(t){var o,a;return o=null!=e.state.fileList.find(function(e){var t;return(t=e.status)===A.PENDING||t===A.UPLOADING}),o&&e.state.fileList.count()>0?(a=V("Leaving this page will cancel your uploads."),t.returnValue=a,a):void 0}})(this)),this.state.user&&this.fetchQuotaUpsellInfo(),k.end(this.constructor.displayName)},updateInlineStatus:function(){var e,o,s,r;return r=null!=this.state.fileList.find(function(e){var t;return(t=e.status)===A.PENDING||t===A.UPLOADING}),s=!this.state.isUploadModalOpen&&(r||this.state.fileList.count()>0&&!r&&!this.state.isInlineStatusDismissed),e=t("."+this.INLINE_STATUS_CONTAINER_CLASS),s?a.render(W(R,{fileList:this.state.fileList,currentUpload:this.state.currentUpload,onViewDetails:this._handleInlineStatusViewDetails,numSecondsLeft:this.state.numSecondsLeft}),e[0]):(o=e[0])?a.unmountComponentAtNode(o):void 0},componentWillReceiveProps:function(e){if(this.showOverquotaError())return this.setState({hasOverquotaError:!0,isInlineStatusDismissed:!0})},componentWillUpdate:function(e,t){var o,a,s;if(null==t.currentUpload&&null!=this.state.currentUpload&&("function"==typeof(o=this.props).onFileUploadComplete&&o.onFileUploadComplete(this.state.currentUpload),this.state.isTeamOnboarding&&q.log("uploaded_file")),t.fileList!==this.state.fileList&&(s=null!=t.fileList.find(function(e){var t;return(t=e.status)===A.PENDING||t===A.UPLOADING}),!s&&t.fileList.count()>0&&("V2"!==this.props.expSubgrowthProNearquotaUploadModal||this.state.seenNearquotaModal||this._showNearquotaModal(),"function"==typeof(a=this.props).onAllFileUploadsComplete&&a.onAllFileUploadsComplete(this.state.fileList))),!this.state.hasOverquotaError&&t.hasOverquotaError)return this.showOOQModal()},componentDidUpdate:function(e,o){var a,s;if(a=t(".external-drop-indicator"),this.state.numDraggingFiles&&!this.state.isInternalTransfer?(o.numDraggingFiles||a.css("opacity",0).fadeTo(500,.6),this.state.hasPermissionToUploadToFolder?a.removeClass("external-drop-indicator--uploads-disabled"):a.addClass("external-drop-indicator--uploads-disabled"),this.state.isUploadModalOpen||(this.state.hasPermissionToUploadToFolder?(s=V("Drop your files to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:j({user:this.state.user,path:this.state.path})}),I.success(s,60)):I.error(V("You don’t have permission to add to this folder.")))):!this.state.numDraggingFiles&&o.numDraggingFiles&&(a.hide().removeClass("external-drop-indicator--uploads-disabled"),I.clear()),this.updateInlineStatus(),!o.user&&this.state.user&&this.fetchQuotaUpsellInfo(),0===o.fileList.count()&&this.state.fileList.count()>0)return this.setBrowseButton(!1)},fetchQuotaUpsellInfo:function(){return n.SilentBackgroundRequest({url:"/get_info_for_quota_upsell",data:{_subject_uid:this.state.user.id},success:(function(e){return function(t){return t=JSON.parse(t),e.setState({userQuotaUsageRatio:t.user_quota_usage_ratio,tsdQuotaUsageRatio:t.tsd_quota_usage_ratio,promptAdminToUpgradeEmailTemplateUrl:t.prompt_admin_to_upgrade_email_template_url,numTeamMembers:t.num_team_members,numTeamAdmins:t.num_team_admins,teamAdminEmail:t.team_admin_email,teamAdminFname:t.team_admin_fname})}})(this)})},setBrowseButton:function(e){var o,a;if(o=C.NONE,0===this.state.user.paid&&("personal"===this.state.user.role?this.state.userQuotaUsageRatio>1?o=C.BASIC_OVER_QUOTA:this.state.userQuotaUsageRatio>.9&&(o=C.BASIC_NEAR_QUOTA):this.state.user.is_team&&b.get_viewer().team_is_limited&&(this.state.user.is_cdm_member&&!this.state.path.startsWith(this.state.user.cdm_tmf_path)?this.state.tsdQuotaUsageRatio>1&&(o=C.LIMITED_TEAM_TSD_OVER_QUOTA):this.state.userQuotaUsageRatio>1&&(o=C.LIMITED_TEAM_USER_OVER_QUOTA))),this.setState({overQuotaStatus:o}),this.props.removeBasicUploader){if(!e&&!z.isUploadModalOpen())return E.setBrowseButton(null);if(0===this.state.fileList.count()&&((a=this.state.overQuotaStatus)===C.NONE||a===C.BASIC_NEAR_QUOTA))return E.setBrowseButton(t(".appactions-menu .action-upload"))}},componentWillUnmount:function(){return t(document).off("dragover.fileUploader").off("dragenter.fileUploader").off("dragleave.fileUploader").off("drop.fileUploader"),t("."+this.INLINE_STATUS_CONTAINER_CLASS).remove(),t(window).off("beforeunload.fileUploader"),Z=null},_handleFileDrop:function(e){var t,o,a,s,r,n,l,u,d,p,m,f,h,_,g,U,E,T,v,b,N,D,O,S,P,F,R,M;if(e.preventDefault(),e.stopPropagation(),this.dragEnterCount=0,this.lastEnteredElement=null,G.setNumDraggingFiles({numDraggingFiles:0}),t=e.originalEvent.dataTransfer,o=y.msie?"text":"application/x-dropbox-file-list",g=t.getData(o),null!=g)try{if(P=JSON.parse(g),M=P.userId,h=P.fromPath,p=P.filePaths,(null!=p?p.length:void 0)>0&&null!=h&&null!=M){if(Y.context().isNonUserRelativeContext)return;return this.state.hasPermissionToUploadToFolder?M!==this.state.user.id?void I.error(V("You can’t move or copy files here from another Dropbox.")):(R=e.ctrlKey||e.altKey,R?H.copyFiles({files:p.map(function(e){return{fq_path:e}}),newPath:this.state.path}):h!==this.state.path&&(c.logMoveFiles({uid:M,path:h,files:p,newPath:this.state.path,source:w.DRAG}),H.moveFiles({path:h,files:p.map(function(e){return{fq_path:e}}),newPath:this.state.path})),void G.setPath({path:Y.path()})):void I.error(V("You don’t have permission to add to this folder."))}}catch(e){}if(this.state.hasPermissionToUploadToFolder){if(s=i.getDraggedLink(t),null!=s)return S=i.buildUrlLinkfileContents(s),O=new Blob([S],{type:"text/plain"}),D=L.parse(s).getAuthority(),O.name=D+".url",O.overwrite=!1,c.logUploadFile({uid:this.state.user.id,num_files:1,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),void G.addFilesToPLU({files:[O]});if(E=t.items,m=t.files,null!=(null!=E&&null!=(F=E[0])?F.webkitGetAsEntry:void 0)&&this.props.uploaderFixGating){for(n=(function(){var e,t,o;for(o=[],_=e=0,t=E.length;0<=t?e<t:e>t;_=0<=t?++e:--e)o.push(E[_].webkitGetAsEntry());return o})(),u=(function(){var e,t,o;for(o=[],e=0,t=n.length;e<t;e++)r=n[e],(null!=r?r.isFile:void 0)&&o.push(r);return o})(),a=(function(){var e,t,o;for(o=[],e=0,t=n.length;e<t;e++)r=n[e],(null!=r?r.isDirectory:void 0)&&o.push(r);return o})(),c.logUploadFile({uid:this.state.user.id,num_files:u.length,num_dirs:a.length,uploader_type:"drag",upload_method:"drag"}),T=0,b=u.length;T<b;T++)d=u[T],d.file(function(e){return G.addFilesToPLU({files:[e]})});if(a.length>0)return G.addDirectoriesToPLU({directoryEntries:a})}else if(null!=(null!=m?m.length:void 0)){for(U=function(e){return null!=e&&null!=e.type&&null!=e.size&&""===e.type&&e.size%4096===0},m=(function(){var e,t,o;for(o=[],_=e=0,t=m.length;0<=t?e<t:e>t;_=0<=t?++e:--e)o.push(m.item(_));return o})(),f=(function(e){return function(){var t;if(U(l))return t=new FileReader,t.onerror=function(){var t,o;if(t=null!=(o=e.state.fileList.find(function(e){var t;return((t=e.status)===A.PENDING||t===A.UPLOADING)&&e.name===l.name}))?o.toJS():void 0,null!=t)return G.manuallySetInErrorState({file:t,errorType:Q.EMPTY_OR_FOLDER,errorMessage:V("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")})},t.readAsArrayBuffer(l)}})(this),v=0,N=m.length;v<N;v++)l=m[v],f();return c.logUploadFile({uid:this.state.user.id,num_files:m.length,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),G.addFilesToPLU({files:m})}}},_handleInlineStatusViewDetails:function(){return this.showModal()},showOverquotaError:function(){var e,t;return(null!=(e=this.state.fileList)&&null!=(t=e.last())?t.errorType:void 0)===Q.OVER_QUOTA_ERROR},render:function(){return $.div({})}}),{FileUploader:S}})}.call(this);
//# sourceMappingURL=pkg-file_uploader.min.js-vflme2q9P.map